<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, `user-scalable=no">
    <link rel="stylesheet" href="css/custom.css" />
    <link rel="stylesheet" href="css/custom-mobile.css" />
    <link rel="stylesheet" href="css/custom-even.css" />
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
    <title>Even_onlline</title>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="js/mc.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/rolldate.js"></script>
    <style>
        .menu .ui-mini.ui-btn-icon-left:after,
        .ui-mini .ui-btn-icon-left:after,
        .ui-header .ui-btn-icon-left:after,
        .ui-footer .ui-btn-icon-left:after {
            display: none;
        }

        .ui-btn-icon-left {
            position: relative;
            padding-left: 12px !important;
            bottom: 8px;
        }

        .ui-icon-minus {
            width: 123px !important;
        }

        .ui-icon-plus {
            width: 14px !important;
        }

        .ui-collapsible-inset .ui-collapsible-heading .ui-btn {
            box-shadow: none !important;
        }
    </style>

    <script>
        // VARIÁVEIS ACESSADAS VIA QUERY.PARAMS
        var num_empree = getquerystring("e");
        var login = getquerystring("l");
        var senha = getquerystring("s");

        var id_prog_manut = getquerystring("ipm");
        var dia_ev = getquerystring("dia_ev");
        var mes_ev = getquerystring("mes_ev");
        var ano_ev = getquerystring("ano_ev");
        var d_min = getquerystring("d_min");
        var d_max = getquerystring("d_max");
        var tipo = getquerystring("tipo");

        var input_data_realiz = getquerystring("input_data_realiz");
        var input_forn = getquerystring("input_forn");
        var input_custoReal = getquerystring("input_custoReal");
        var input_custoEstim = getquerystring("input_custoEstim");
        var input_obsCondo = getquerystring("input_obsCondo");
        var input_obsConstr = getquerystring("input_obsConstr");

        var id_cliente;
        var id_empree = "";
        var nome_sistema = ""
        var data_de_hoje = new Date();
        var e_construtora = "";
        var nivel_manut;
        var qt_docs;
        var qt_docs_constr;

        var qtdDocs_Device = 0
        var ev_email = 0

        var apagar1;

        var editPictures = null;
        var uploadAutomatic = false;

        var qtd_tam_ti = 0;
        var qtd_tam_ti_audio = 0;
        var qtd_tam_ti_video = 0;
        var qtd_tam_ti_texto = 0;

        // FUNÇÃO QUE APRESENTA O ERRO NA APLICAÇÃO
        window.onerror = function (message, url, lineNumber) {
            alert(`Erro: ${message} em ${url} na linha ${lineNumber}. Por favor, tente novamente.`);
            reload_page();
        }

        // INICIALIZA O PROCESSAMENTO DA APLICAÇÃO
        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {

            pictureSource = navigator.camera.PictureSourceType;
            destinationType = navigator.camera.DestinationType;
            mediaType = navigator.camera.MediaType;

            if (tem_conexao()) {
                iniciar()
            } else {
                window.location.assign("even.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
            }
        }

        // EXECUTA CASO TENHA INTERNET
        function iniciar() {
            window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
            window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
            window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

            if (!window.indexedDB) {
                alert("Seu navegador não suporta uma versão estável do IndexedDB. Alguns recursos não estarão disponíveis.");
            }

            var rrr_id_prog_manut = id_prog_manut

            // CASCA OFFLINE
            var menu_sup_offline = [
                '<form name="form_sup" action="" method="get">',
                '<div data-role="header" data-position="fixed" data-theme="a">',
                '<div class="ui-corner-all custom-corners">',
                '<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
                '<div class="barra1" align="left"><img src="images/wifi_vermelho.png" style="position: absolute; left: 70px; top: 20px;" width="17" /></div>',
                '<div align="center">',
                '<a href="#"><button style="box-shadow: none !important; background: #ebebeb !important; border: none;" onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-carat-l">Voltar</button></a>',
                '<table width="30" border="0" cellpadding="0" cellspacing="0" >',
                '<tr>',
                '<td width="30" ><img src="images/logo6.png" width="142"> </td>',
                '</tr>',
                '</table>',
                '</div>',
                '</div>',
                '</div>',
                '</div>',
                '</form>'
            ].join('');

            // CASCA ONLINE
            var menu_sup_online = [
                '<form name="form_sup" action="" method="get">',
                '<div data-role="header" data-position="fixed" data-theme="a">',
                '<div class="ui-corner-all custom-corners">',
                '<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
                '<div class="barra1" align="left"><img src="images/wifi_verde.png" style="position: absolute; left: 70px; top: 20px;" width="17" /></div>',
                '<div align="center">',
                '<a href="#"><button style="box-shadow: none !important; background: #ebebeb !important; border: none;" onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-carat-l">Voltar</button></a>',
                '<table width="30" border="0" cellpadding="0" cellspacing="0" >',
                '<tr>',
                '<td width="30" ><img src="images/logo6.png" width="142"> </td>',
                '</tr>',
                '</table>',
                '</div>',
                '</div>',
                '</div>',
                '</div>',
                '</form>'
            ].join('');

            document.getElementById('menu_opc2').innerHTML = menu_sup_online;


            // FUNÇÃO QUE VERIFICA SE TEM INTERNET A CADA 5 SEGUNDOS
            setInterval(function () {
                // window.StatusBar.hide();

                if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
                    document.getElementById('menu_opc2').innerHTML = menu_sup_offline;
                    return false;
                } else {
                    document.getElementById('menu_opc2').innerHTML = menu_sup_online;
                    return true;
                }
            }, 5000);

            var ajax2 = new XMLHttpRequest();
            ajax2.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_dados_evento_online.asp?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&versao=2.2&t=" + Math.random(), false);
            ajax2.addEventListener("loadend", function (evt) {
                var resposta_total = this.responseText;
                var jsontext = resposta_total.split("#")

                var getLogin = JSON.parse(jsontext[0]);
                var logou = getLogin.logou;

                if (logou == "S") {

                    // DADOS COLETADOS DA REQUISIÇÃO
                    id_cliente = getLogin.id_cliente;
                    e_construtora = getLogin.e_construtora;
                    var nome_empree = getLogin.nome_empree;
                    id_empree = getLogin.id_empree;
                    nome_sistema = getLogin.nome_sistema;
                    var nome_atividade = getLogin.nome_atividade;
                    var aux_data = getLogin.aux_data;
                    var periodicidade = getLogin.periodicidade;
                    var nome_emp_resp = getLogin.nome_emp_resp;
                    var data_manut_realizada = getLogin.data_manut_realizada;
                    var custo_estimado = getLogin.custo_estimado;
                    var custo_real = getLogin.custo_real;
                    nivel_manut = getLogin.nivel_manut;
                    qt_docs = getLogin.qt_docs;
                    qt_docs_constr = getLogin.qt_docs_constr;
                    var fornecedor = getLogin.fornecedor;
                    var observacao_evento = getLogin.observacao_evento;
                    var observacao_evento_construtora = getLogin.observacao_evento_construtora;
                    var id_ajuda_docs = getLogin.id_ajuda_docs;

                    var getCaminhos = jsontext[1];
                    var objCaminhos = JSON.parse(getCaminhos);

                    var trecho_imagens_constr_imagens = "";
                    var trecho_imagens_constr_videos = "";
                    var trecho_imagens_constr_audios = "";
                    var trecho_imagens_constr_textos = "";

                    var dados_popup_img = "";

                    var trecho_imagens_cond_imagens = "";
                    var trecho_imagens_cond_videos = "";
                    var trecho_imagens_cond_audios = "";
                    var trecho_imagens_cond_textos = "";
                    var dados_manutencao = "";
                    var dados_documentos = "";
                    var dados_observacao = "";
                    var dados_ajuda_docs = "";

                    var texto_total;
                    var variavelx = "";
                    var variavelx2 = "";

                    // CONDIÇÃO QUE VERIFICA SE TEM ALGUM DOCUMENTO DO CONDOMÍNIO DENTRO DA GALERIA DE IMAGENS SERVIDOR
                    if (qt_docs == 0) {
                        document.getElementById('condominio_content').innerHTML = [
                            '<div class="ui-body ui-body-a">',
                            '<h4 class="margin">',
                            '<strong class="is-red">Galeria condomínio vazia</strong>',
                            '</h4>',
                            '<div id="imagens_bco"></div>',
                            '<div id="videos_bco"></div>',
                            '<div id="audios_bco"></div>',
                            '<div id="textos_bco"></div>',
                            '</div>'
                        ].join('')
                    }

                    // CONDIÇÃO QUE VERIFICA SE TEM ALGUM DOCUMENTO DA CONSTRUTORA DENTRO DA GALERIA DE IMAGENS SERVIDOR
                    if (qt_docs_constr == 0) {
                        document.getElementById('construtora_content').innerHTML = [
                            '<div class="ui-body ui-body-a">',
                            '<h4 class="margin">',
                            '<strong class="is-red">Galeria construtora vazia</strong>',
                            '</h4>',
                            '<div id="imagens_bco_constr"></div>',
                            '<div id="videos_bco_constr"></div>',
                            '<div id="audios_bco_constr"></div>',
                            '<div id="textos_bco_constr"></div>',
                            '</div>'
                        ].join('')
                    }

                    // VERIFICA A ORIGEM E TIPO DO ARQUIVO
                    for (i = 0; i < objCaminhos.cam_arquivos.length; i++) {

                        if (objCaminhos.cam_arquivos[i].ori == 'd' && e_construtora == '0') {
                            if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                trecho_imagens_cond_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                trecho_imagens_cond_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                trecho_imagens_cond_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '"></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 19px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                trecho_imagens_cond_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 15px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + texto_total[0] + String.fromCharCode(39) + ')"></button></div>'
                            }
                        } else if (objCaminhos.cam_arquivos[i].ori == 'd' && e_construtora == '1') {
                            if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                trecho_imagens_cond_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                trecho_imagens_cond_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                trecho_imagens_cond_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '"></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                trecho_imagens_cond_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            }
                        } else if (objCaminhos.cam_arquivos[i].ori == 's' && e_construtora == '1') {
                            if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                trecho_imagens_constr_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                trecho_imagens_constr_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                trecho_imagens_constr_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '"></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 19px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                trecho_imagens_constr_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 15px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + texto_total[0] + String.fromCharCode(39) + ')"></button></div>'
                            }
                        } else if (objCaminhos.cam_arquivos[i].ori == 's' && e_construtora == '0') {
                            if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                trecho_imagens_constr_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                trecho_imagens_constr_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                trecho_imagens_constr_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '"></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                trecho_imagens_constr_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                            }
                        }
                    }

                    var ini_lista = "<ul id='q_empree' class='list-content' data-mini='true' data-role='listview' data-filter='true' data-filter-placeholder='Buscar...' data-inset='true'>";
                    var fim_lista = "</ul>";

                    var seleciona1 = ""
                    var seleciona2 = ""
                    var seleciona3 = ""

                    var aux_data_preench;
                    var aux_custoReal_preench;
                    var aux_custoEstim_preench;
                    var aux_obsCondo_preench;
                    var aux_obsConstr_preench;

                    if (input_data_realiz == "") {
                        if (getMobileOperatingSystem() == "iOS") {
                            aux_data_preench = data_manut_realizada
                        } else {
                            aux_data_preench = dateToEN2(data_manut_realizada)
                        }
                    } else {
                        aux_data_preench = input_data_realiz
                    }

                    if (input_forn == "") {
                        if (fornecedor == "Equipe Local") {
                            seleciona1 = "selected"
                        }
                        if (fornecedor == "Empresa Capacitada") {
                            seleciona2 = "selected"
                        }
                        if (fornecedor == "Empresa Especializada") {
                            seleciona3 = "selected"
                        }
                    } else {
                        if (input_forn == "1") {
                            seleciona1 = "selected"
                        }
                        if (input_forn == "2") {
                            seleciona2 = "selected"
                        }
                        if (input_forn == "3") {
                            seleciona3 = "selected"
                        }
                    }

                    if (input_custoReal == "") {
                        aux_custoReal_preench = custo_real
                    } else {
                        aux_custoReal_preench = input_custoReal
                    }

                    if (input_custoEstim == "") {
                        aux_custoEstim_preench = custo_estimado
                    } else {
                        aux_custoEstim_preench = input_custoEstim
                    }

                    if (e_construtora == '0') {
                        if (getMobileOperatingSystem() == "iOS") {
                            dados_manutencao = [
                                '<li class="shadow_box">',
                                '<div class="text-center-title">',
                                '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                '</div>',
                                '<div class="text-center-paragraph">',
                                '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                '</div>',
                                '<div class="mensalmente-paragraph">',
                                '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                '</div>',
                                '<div class="data_periodicidade_paragraph">',
                                '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                '</div>',
                                '</li>',

                                '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a">',
                                '<tbody>',
                                '<tr>',
                                '<th style="padding: 0">',
                                '<div class="input-responsive">',
                                '<label for="">Data realização:</label>',
                                '<input maxlength="10" style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao date_ios" onclick="scrollDate()" id="in_data_realizacao" readonly="readonly" required="" value="' + aux_data_preench + '" />',
                                '<img src="images/calendar-alt.png" width="16" style="position: relative; float: right; bottom: 35px; right: 10px;" />',
                                '</div>',
                                '</th>',
                                '</tr>',
                                '</tbody>',
                                '</div>',
                                '<div style="position: relative;" class="ui-block-b">',
                                '<label for="">Empresa:</label>',
                                '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">',
                                '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                '</select>',
                                '</div>',
                                '</div>',
                                '<table>',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a custo-estimado">',
                                '<label for="">Custo estimado:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo estimado" value="' + aux_custoEstim_preench + '" />',
                                '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '<div class="ui-block-b custo-real">',
                                '<label for="">Custo real:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo real" value="' + aux_custoReal_preench + '" />',
                                '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '</div>',
                                '</table>',
                                '</li>'
                            ].join('');
                        } else {
                            dados_manutencao = [
                                '<li class="shadow_box">',
                                '<div class="text-center-title">',
                                '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                '</div>',
                                '<div class="text-center-paragraph">',
                                '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                '</div>',
                                '<div class="mensalmente-paragraph">',
                                '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                '</div>',
                                '<div class="data_periodicidade_paragraph">',
                                '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                '</div>',
                                '</li>',

                                '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a">',
                                '<tbody>',
                                '<tr>',
                                '<th style="padding: 0">',
                                '<div class="input-responsive">',
                                '<label for="">Data realização:</label>',
                                '<input style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao" id="in_data_realizacao" type="date" onkeypress="mascara(this, sonumeros_data)" required="" value="' + aux_data_preench + '" />',
                                '</div>',
                                '</th>',
                                '</tr>',
                                '</tbody>',
                                '</div>',
                                '<div style="position: relative;" class="ui-block-b">',
                                '<label for="">Empresa:</label>',
                                '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">',
                                '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                '</select>',
                                '</div>',
                                '</div>',
                                '<table>',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a custo-estimado">',
                                '<label for="">Custo estimado:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo estimado" value="' + aux_custoEstim_preench + '" />',
                                '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '<div class="ui-block-b custo-real">',
                                '<label for="">Custo real:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo real" value="' + aux_custoReal_preench + '" />',
                                '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '</div>',
                                '</table>',
                                '</li>'
                            ].join('');
                        }
                    } else {
                        if (getMobileOperatingSystem() == "iOS") {
                            dados_manutencao = [
                                '<li class="shadow_box">',
                                '<div class="text-center-title">',
                                '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                '</div>',
                                '<div class="text-center-paragraph">',
                                '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                '</div>',
                                '<div class="mensalmente-paragraph">',
                                '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                '</div>',
                                '<div class="data_periodicidade_paragraph">',
                                '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                '</div>',
                                '</li>',

                                '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a">',
                                '<tbody>',
                                '<tr>',
                                '<th style="padding: 0">',
                                '<div class="input-responsive">',
                                '<label for="">Data realização:</label>',
                                '<input maxlength="10" style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao date_ios" id="in_data_realizacao" disabled="" readonly="readonly" required="" value="' + aux_data_preench + '" />',
                                '<img src="images/calendar-alt.png" width="16" style="position: relative; float: right; bottom: 35px; right: 10px;" />',
                                '</div>',
                                '</th>',
                                '</tr>',
                                '</tbody>',
                                '</div>',
                                '<div style="position: relative;" class="ui-block-b">',
                                '<label for="">Empresa:</label>',
                                '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" disabled="">',
                                '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                '</select>',
                                '</div>',
                                '</div>',
                                '<table>',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a custo-estimado">',
                                '<label for="">Custo estimado:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo estimado" disabled="" value="' + aux_custoEstim_preench + '" />',
                                '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '<div class="ui-block-b custo-real">',
                                '<label for="">Custo real:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo real" disabled="" value="' + aux_custoReal_preench + '" />',
                                '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '</div>',
                                '</table>',
                                '</li>'
                            ].join('');
                        } else {
                            dados_manutencao = [
                                '<li class="shadow_box">',
                                '<div class="text-center-title">',
                                '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                '</div>',
                                '<div class="text-center-paragraph">',
                                '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                '</div>',
                                '<div class="mensalmente-paragraph">',
                                '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                '</div>',
                                '<div class="data_periodicidade_paragraph">',
                                '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                '</div>',
                                '</li>',

                                '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a">',
                                '<tbody>',
                                '<tr>',
                                '<th style="padding: 0">',
                                '<div class="input-responsive">',
                                '<label for="">Data realização:</label>',
                                '<input style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao" type="date" onkeypress="mascara(this, sonumeros_data)" id="in_data_realizacao" disabled="" required="" value="' + aux_data_preench + '" />',
                                '</div>',
                                '</th>',
                                '</tr>',
                                '</tbody>',
                                '</div>',
                                '<div style="position: relative;" class="ui-block-b">',
                                '<label for="">Empresa:</label>',
                                '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" disabled="">',
                                '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                '</select>',
                                '</div>',
                                '</div>',
                                '<table>',
                                '<div class="ui-grid-a">',
                                '<div class="ui-block-a custo-estimado">',
                                '<label for="">Custo estimado:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo estimado" disabled="" value="' + aux_custoEstim_preench + '" />',
                                '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '<div class="ui-block-b custo-real">',
                                '<label for="">Custo real:</label>',
                                '<input maxlength="9" style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeyup="mascara(this, mascaraTeste)" placeholder="Custo real" disabled="" value="' + aux_custoReal_preench + '" />',
                                '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                '</div>',
                                '</div>',
                                '</table>',
                                '</li>'
                            ].join('');
                        }
                    }

                    if (e_construtora == '0') {
                        dados_observacao = [
                            '<li style="padding: .7em 1em; background: #fff;" class="shadow_box" style="border-radius: 0;">',
                            '<table>',
                            '<div class="ui-grid ui-responsive">',
                            '<div class="ui-block-a ui-grid-full">',
                            '<table data-role="table" id="table-column-toggle" class="ui-responsive table-stroke">',
                            '<tbody>',
                            '<label style="font-weight: 600;" class="label-center" for="textarea-1">Observações</label>',
                            '<label style="margin-top: 15px;" for="">Condomínio:</label>',
                            '<textarea rows="3" style="width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 condominio condominio_obs" name="textarea-1" id="txt_dado_condominio" data-placeholder="true" placeholder="Condomínio..." autocomplete="off" onclick="RestricaoData_obs();" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">' + observacao_evento + '</textarea>',
                            '<fieldset data-role="controlgroup">',
                            '<div id="form_email" style="background: #f5f5f5; position: relative; top: 3px; padding: 3px; border-radius: 4px; border: 1px solid #dddddd;">',
                            '<div style="display: flex; align-items: center;">',
                            '<input style="height: 20px; width: 20px; margin-right: 4px;" type="checkbox" name="email_condominio" id="email_condominio">',
                            '<span style="font-size: 12px;"><span style="color: rgb(153, 0, 0);">Marque e clique em salvar abaixo para enviar um alerta</span> por email a construtora.</span>',
                            '</div>',
                            '</div>',
                            '</fieldset>',
                            '</tbody>',
                            '<tbody>',
                            '<label style="margin-top: 10px;" for="">Construtora:</label>',
                            '<textarea rows="3" style="background: #e7e7e7; width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 construtora" name="textarea-1" id="txt_dado_construtora" data-placeholder="true" placeholder="Construtora..." autocomplete="off" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" readonly="readonly">' + observacao_evento_construtora + '</textarea>',
                            '</tbody>',
                            '</table>',
                            '</div>',
                            '</div>',
                            '</table>',
                            '</li>'
                        ].join('');
                    } else {
                        dados_observacao = [
                            '<li style="padding: .7em 1em; background: #fff;" class="shadow_box" style="border-radius: 0;">',
                            '<table>',
                            '<div class="ui-grid ui-responsive">',
                            '<div class="ui-block-a ui-grid-full">',
                            '<table data-role="table" id="table-column-toggle" class="ui-responsive table-stroke">',
                            '<tbody>',
                            '<label style="font-weight: 600;" class="label-center" for="textarea-1">Observações</label>',
                            '<label style="margin-top: 15px;" for="">Condomínio:</label>',
                            '<textarea rows="3" style="background: #e7e7e7; width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 condominio" name="textarea-1" id="txt_dado_condominio" data-placeholder="true" placeholder="Condomínio..." autocomplete="off" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" readonly="readonly">' + observacao_evento + '</textarea>',
                            '</tbody>',
                            '<tbody>',
                            '<label style="margin-top: 10px;" for="">Construtora:</label>',
                            '<textarea rows="3" style="width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 construtora construtora_obs" name="textarea-1" id="txt_dado_construtora" data-placeholder="true" placeholder="Construtora..." autocomplete="off" onclick="RestricaoData_obs_constr();" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">' + observacao_evento_construtora + '</textarea>',
                            '<fieldset data-role="controlgroup">',
                            '<div style="background: #f5f5f5; position: relative; top: 3px; padding: 3px; border-radius: 4px; border: 1px solid #dddddd;">',
                            '<div style="display: flex; align-items: center;">',
                            '<input style="height: 20px; width: 20px; margin-right: 4px;" type="checkbox" name="email_construtora" id="email_construtora">',
                            '<span style="font-size: 12px;"><span style="color: rgb(153, 0, 0);">Marque e clique em salvar abaixo para enviar um alerta</span> por email ao condomínio.</span>',
                            '</div>',
                            '</div>',
                            '</fieldset>',
                            '</tbody>',
                            '</table>',
                            '</div>',
                            '</div>',
                            '</table>',
                            '</li>'
                        ].join('');
                    }

                    dados_ajuda_docs = [
                        '<div class="screen-over-content ui-responsive">',
                        '<div class="title-content">',
                        '<span class="size-14">Documentos a serem anexados para esta manutenção:</span>',
                        '<span style="text-align: center;" class="size-14" style="display: block;">',
                        '<strong>Nota fiscal</strong>',
                        '</span>',
                        '</div>',
                        '<div class="image-content">',
                        '<img style="width: 100%; height: auto;" src="https://www.sigmacivil.com.br/us/imagens/ajuda_docs/' + id_ajuda_docs + '.gif" alt="" />',
                        '</div>',
                        '<div class="title-content" style="margin-top: 15px;">',
                        '<span style="text-align: center;" class="size-14">Arquivo de exemplo</span>',
                        '</div>',
                        '</div>'
                    ].join('')

                    document.getElementById('nome_empree_id').innerHTML = nome_empree
                    document.getElementById('dados_ajuda').innerHTML = dados_ajuda_docs
                    document.getElementById('dados_manut').innerHTML = ini_lista + dados_manutencao + fim_lista
                    document.getElementById('dados_obs').innerHTML = dados_observacao

                    document.getElementById('popup_img').innerHTML = dados_popup_img

                    document.getElementById('imagens_bco').innerHTML = trecho_imagens_cond_imagens
                    document.getElementById('videos_bco').innerHTML = trecho_imagens_cond_videos
                    document.getElementById('audios_bco').innerHTML = trecho_imagens_cond_audios
                    document.getElementById('textos_bco').innerHTML = trecho_imagens_cond_textos

                    document.getElementById('imagens_bco_constr').innerHTML = trecho_imagens_constr_imagens
                    document.getElementById('videos_bco_constr').innerHTML = trecho_imagens_constr_videos
                    document.getElementById('audios_bco_constr').innerHTML = trecho_imagens_constr_audios
                    document.getElementById('textos_bco_constr').innerHTML = trecho_imagens_constr_textos
                    $('#q_empree').listview();

                    eval(variavelx);
                    eval(variavelx2);

                }
            });

            ajax2.send();

            // capturando dados evento

            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 01)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                consultaManutEvento(db);

                consultaConfig();

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function consultaManutEvento(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                var objectStoreRequest = index.openCursor(whereEquals);
                objectStoreRequest.onsuccess = function (event) {
                    var cursor = event.target.result;

                    var i;
                    var meio_empree = "";
                    var final_empree = "";
                    var tam_ti;
                    var aux_image_upload;

                    if (cursor) {
                        var rrr_caminho_imagens = cursor.value.caminho_imagens;
                        var rrr_caminho_texto = cursor.value.caminho_texto;
                        var rrr_caminho_audio = cursor.value.caminho_audio;

                        apagar1 = rrr_caminho_audio;

                        var rrr_caminho_video = cursor.value.caminho_video;
                        var rrr_id_prog_manut = cursor.value.id_prog_manut;
                        var rrr_status_caminho_imagens = cursor.value.status_imagens_upl;
                        var rrr_status_caminho_video = cursor.value.status_video_upl;
                        var rrr_status_caminho_audio = cursor.value.status_audio_upl;
                        var rrr_status_caminho_texto = cursor.value.status_texto_upl;

                    } else {
                        var rrr_caminho_imagens = ""
                        var rrr_caminho_texto = ""
                        var rrr_caminho_audio = ""
                        var rrr_caminho_video = ""
                        var rrr_id_prog_manut = id_prog_manut
                        var rrr_status_caminho_imagens = ""
                        var rrr_status_caminho_video = ""
                        var rrr_status_caminho_audio = ""
                        var rrr_status_caminho_texto = ""
                    }

                    var todas_imagens = ""
                    var todas_status_imagens = ""
                    if (rrr_caminho_imagens == null || rrr_caminho_imagens == "") {
                        tam_ti = 0;
                    }
                    else {
                        todas_imagens = rrr_caminho_imagens.split("**");
                        todas_status_imagens = rrr_status_caminho_imagens.split("**");
                        tam_ti = todas_imagens.length;
                    }

                    var selec_imagens_thumb = ""
                    var selec_imagens = ""

                    for (k = 0; k < tam_ti; k++) {

                        if (todas_status_imagens[k] == '0') {
                            aux_image_upload = 'upload.png';
                            qtdDocs_Device += 1
                        }
                        else {
                            aux_image_upload = 'upload_verde.png';
                        }

                        // automatic upload
                        if (aux_image_upload == 'upload.png') {
                            qtd_tam_ti = k + 1;
                        }


                        //imagens da seta, preta ou verde

                        selec_imagens_thumb = selec_imagens_thumb + "<div style='float:left; position: relative; left: 1.5px;'><div style='border: 1px solid #5d5d5d'><table cellpadding='0' cellspacing='0'><img src='" + todas_imagens[k] + "'  onclick='abrir_popup(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + "," + String.fromCharCode(34) + k + String.fromCharCode(34) + " )'  width='106' height='70' hspace='2' vspace='2'/><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 5px; text-shadow: none;' class='icon-size' width='15' onclick='deletar_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'></div><div align='center'><img src='images/" + aux_image_upload + "' style='float: right; padding: 0.5rem; position: relative; right: 5px; text-shadow: none;' class='icon-size' width='17' onclick='upload_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")' s></div></table></div></div></div>"
                        selec_imagens = selec_imagens + "<div data-role='popup' id='idpopup_" + rrr_id_prog_manut + "_" + k + "'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right'>Close</a> <img class='popphoto' src='" + todas_imagens[k] + "' style='max-height:512px;'> </div>"

                        //Popup
                    }

                    if (rrr_status_caminho_audio == '0') {
                        aux_image_upload = "upload.png";
                    }
                    else {
                        aux_image_upload = "upload_verde.png";
                    }
                    //se ta preta ou verde do áudio

                    var selec_audio;
                    if (rrr_caminho_audio == "") {
                        selec_audio = "<div style='position: relative; left: 15px; top: 17px;'><table cellpadding='0' cellspacing='0'><audio style='margin-bottom: 10px; width: 80%; display: none;' controls><source src='" + rrr_caminho_audio + "'></audio><div align='center'><img src='images/trash.svg' class='icon-size' width='15' onclick='deletar_audio()' style='display:none'></div><div align='center'><img src='images/" + aux_image_upload + "' class='icon-size' width='16' onclick='upload_audio()' style='display:none'></div></table></div>"
                        // selec_audio = "<div style='position: relative; left: 15px; top: 17px;'><table cellpadding='0' cellspacing='0'><div id='latesq_" + rrr_id_prog_manut + "'width='40' height='30' style='display:none'></div><img src='images/play.svg' width='15' class='button-play top-9px' id='player_" + rrr_id_prog_manut + "'onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  style='display:none'><img src='images/pause.svg' width='15' class='button-pause top-9px position-icons' id='pause_" + rrr_id_prog_manut + "'onclick='pause_audio()' style='display:none'><img src='images/stop.svg' width='15' class='button-stop top-9px position-icons' id='stop_" + rrr_id_prog_manut + "'onclick='stop_audio()' style='display:none'><img src='images/microphone.svg' width='15' class='button-microfone top-9px position-icons' id='rec_" + rrr_id_prog_manut + "'onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")' style='display:none'><div id='latdir_" + rrr_id_prog_manut + "'width='40' height='30' style='display:none'></div><div align='center'><img src='images/trash.svg' class='icon-size' width='15' onclick='deletar_audio()' style='display:none'></div><div align='center'><img src='images/" + aux_image_upload + "' class='icon-size' width='16' onclick='upload_audio()' style='display:none'></div></table></div>       <audio style='margin-bottom: 10px; width: 100%;' controls><source src='" + rrr_caminho_audio + "'></audio>"
                    }
                    else {
                        selec_audio = "<table cellpadding='0' cellspacing='0'><audio style='margin-left: 10px; width: 80%; display: inline;' controls><source src='" + rrr_caminho_audio + "'></audio><div align='center'><img src='images/trash.svg' style='position: relative; top: 8px; right: 50px; text-align: center; text-shadow: none;' class='icon-size' width='15' onclick='deletar_audio()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='position: relative; bottom: 10px; left: 50px; text-align: center; text-shadow: none;' class='icon-size' width='17' onclick='upload_audio()'></div></table>"
                        // selec_audio = "<div class='icon-size' style='position: relative; text-align: center; top: 10px;'><table cellpadding='0' cellspacing='0'><div id='latesq_" + rrr_id_prog_manut + "'width='40' height='30'></div><div style='border: 1px solid black; width: 60%; border-radius: 3px; margin: 0 auto; padding: 4px;'><img src='images/play.svg' width='15' style='margin-right: 5px;' class='top-9px' id='player_" + rrr_id_prog_manut + "'onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")' ><img src='images/pause.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='pause_" + rrr_id_prog_manut + "' onclick='pause_audio()'><img src='images/stop.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='stop_" + rrr_id_prog_manut + "'onclick='stop_audio()'><img src='images/microphone.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='rec_" + rrr_id_prog_manut + "'onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'></div><div id='latdir_" + rrr_id_prog_manut + "'width='40' height='30'></div><div align='center'><img src='images/trash.svg' style='position: relative; top: 8px; right: 55px; text-align: center; text-shadow: none;' class='icon-size' width='15' onclick='deletar_audio()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='position: relative; bottom: 10px; left: 45px; text-align: center; text-shadow: none;' class='icon-size' width='17' onclick='upload_audio()'></div></table></div>            <audio style='margin-bottom: 10px; width: 100%;' controls><source src='" + rrr_caminho_audio + "'></audio>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                            qtd_tam_ti_audio += 1;
                        }
                    }
                    //barra do áudio

                    if (rrr_status_caminho_video == '0') {
                        aux_image_upload = 'upload.png';
                    }
                    else {
                        aux_image_upload = 'upload_verde.png';
                    }
                    //setinha do vídeo

                    var selec_video;
                    if (rrr_caminho_video == "") {
                        selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:none; margin-left: 5px;'><table cellpadding='0' cellspacing='0'><video id='qvideo_" + rrr_id_prog_manut + "' controls poster='images/video.png' width='150' height='150'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 55px;' class='icon-size' width='15' onclick='deletar_video()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='padding: 0.5rem;' class='icon-size' width='17' onclick='upload_video()'></div></table></div>"
                    }
                    else {
                        selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:inline; margin-left: 5px;'><table cellpadding='0' cellspacing='0'><video id='qvideo_" + rrr_id_prog_manut + "' controls poster='images/video.png' width='150' height='150'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 55px; text-shadow: none;' class='icon-size' width='15' onclick='deletar_video()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='padding: 0.5rem; float: left; position: relative; left: 120px; text-shadow: none;' class='icon-size' width='17' onclick='upload_video()'/></div></table></div>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                            qtd_tam_ti_video += 1;
                        }
                    }
                    //barrinha do vídeo

                    if (rrr_status_caminho_texto == '0') {
                        aux_image_upload = 'upload.png';
                    }
                    else {
                        aux_image_upload = 'upload_verde.png';
                    }
                    //seta do texto

                    var selec_texto;
                    selec_texto = rrr_caminho_texto;

                    var bot_up
                    if (rrr_caminho_texto == "") {
                        bot_up = "<div style='display:none'><img src='images/" + aux_image_upload + "' class='icon-size' width='17' onclick='upload_texto()'></i></div>"
                    }
                    else {
                        bot_up = "<img src='images/" + aux_image_upload + "' style='float: right; position: relative; right: 110px; top: 3px; text-shadow: none;' class='icon-size' width='17' onclick='upload_texto()'></i>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                            qtd_tam_ti_texto += 1;
                        }
                    }

                    var item_camera = [
                        '<img src="images/camera.svg" style="margin-top: 10px; float: left; text-shadow: none;" onclick="getPhoto(pictureSource.CAMERA,' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="40" height="30" style="cursor:pointer"><div style="width: 200px;"><img id="foto_' + rrr_id_prog_manut + '" src=""  onclick="abrir_popup_new(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"  width="106" height="70" hspace="2" vspace="2"  style="display:none"/> </>  <div data-role="popup" id="idpopup_new_' + rrr_id_prog_manut + '"> <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a> <img id="foto_big_' + rrr_id_prog_manut + '"  class="popphoto" src="" style="max-height:512px;"> </div> ' + selec_imagens_thumb + selec_imagens
                    ];

                    var item_video = [
                        '<img src="images/video.svg" id="campo3" style="margin-top: 10px; float: left; text-shadow: none;" width="40" height="30" onclick="captureVideo(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"><div style="display: inline">' + selec_video + '</div>'
                    ];

                    var item_audio = [
                        '<img src="images/volume-up.svg" style="margin-top: 10px; float: left; text-shadow: none;" width="40" height="30" onclick="captureAudio(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" />' + selec_audio
                    ];

                    var item_texto = [
                        '<div style="display: flex"><img src="images/file-alt.svg" style="margin-top: 10px; float: left; display: inline; text-shadow: none;" width="40" height="30"><textarea style="display: flex; border-color: #e4e4e4; border-radius: 3px; width: 100%; padding: 5px; outline: none; resize: none" class="size-14 text_hover textarea_obs" rows="3" cols="32" name="textarea-1" id="textarea_' + rrr_id_prog_manut + '" data-placeholder="true" placeholder="Digite suas observações aqui..." onclick="RestricaoData();" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" maxlength="700">' + selec_texto + '</textarea></div><img src="images/save.svg" style="position: relative; float: left; left: 110px; top: 3px; text-shadow: none;" class="icon-size" width="15" onclick="atualizar_texto(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" style="cursor:pointer"><div align="center">' + bot_up + '</div>'
                    ];

                    var item_voltar = [
                        '<button onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" type="button" class="ui-btn block btn-radius btn-voltar">Voltar</button>'
                    ];

                    $(".loading_page").hide();

                    $(".btn-bars").show();
                    $(".shadow_box_gallery").show();
                    $(".shadow_box").show();

                    document.getElementById('capturar_foto').innerHTML = item_camera;
                    document.getElementById('capturar_video').innerHTML = item_video;
                    document.getElementById('capturar_audio').innerHTML = item_audio;
                    document.getElementById('capturar_texto').innerHTML = item_texto;
                    document.getElementById('btn-voltar').innerHTML = item_voltar;

                    var i2;
                    var tam_ti2;

                    if (cursor) {
                        var rrr2_caminho_imagens = cursor.value.caminho_imagens;
                        var rrr2_id_prog_manut = cursor.value.id_prog_manut;
                    } else {
                        var rrr2_caminho_imagens = "";
                        var rrr2_id_prog_manut = id_prog_manut;
                    }

                    var todas_imagens2 = "";
                    var tam_ti2;
                    if (rrr2_caminho_imagens == null || rrr2_caminho_imagens == "") {
                        tam_ti2 = 0;
                    }
                    else {
                        todas_imagens2 = rrr2_caminho_imagens.split("**");
                        tam_ti2 = todas_imagens2.length;
                    }

                    for (k = 0; k < tam_ti2; k++) {
                        $("#idpopup_" + rrr2_id_prog_manut + "_" + k).popup();
                    }

                    $("#idpopup_new_" + rrr2_id_prog_manut).popup();
                }
            }
        }

        function consultaConfig() {
            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 01)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                var tx = db.transaction(['mtab_config'], 'readwrite');
                var store = tx.objectStore('mtab_config');
                var objectStoreRequest = store.openCursor();
                objectStoreRequest.onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        editPictures = data['editar_fotos'];
                        uploadAutomatic = data['upload_automatico'];

                        setTimeout(function () {
                            if (uploadAutomatic && qtd_tam_ti > 0) {
                                upload_imagem(qtd_tam_ti - 1);
                            }

                            // alert(qtd_tam_ti_audio);

                            if (uploadAutomatic && qtd_tam_ti_audio > 0) {
                                upload_audio();
                            }

                            // alert(qtd_tam_ti_video);

                            if (uploadAutomatic && qtd_tam_ti_video > 0) {
                                upload_video();
                            }

                            // alert(qtd_tam_ti_texto);

                            if (uploadAutomatic && qtd_tam_ti_texto > 0) {
                                upload_texto();
                            }
                        }, 1000);

                    }
                }

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }
        }

        var aux_caminho_imagens = ""
        var aux_status_imagens_upl = ""

        function getPhoto(source, qual) {

            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff2(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            navigator.notification.confirm(
                'Deseja tirar uma foto ou escolher a foto da galeria?',
                function (buttonIndex) {
                    if (buttonIndex === 1) {
                        source = pictureSource.PHOTOLIBRARY;
                    } else {
                        source = pictureSource.CAMERA;
                    }

                    navigator.camera.getPicture(onPhotoURISuccess, onFail, {
                        quality: 50,
                        destinationType: destinationType.FILE_URI,
                        encodingType: Camera.EncodingType.JPEG,
                        popoverOptions: CameraPopoverOptions,
                        saveToPhotoAlbum: true,
                        allowEdit: editPictures ? true : false,
                        sourceType: source
                    });
                },
                'SigmaCivil',
                ['Galeria', 'Tirar uma foto']
            );

            /*var r = confirm("Para tirar uma foto com a câmera selecione OK. Para acessar sua galeria de imagens clique em CANCELAR");
            if (r == true) {
                source = pictureSource.CAMERA;
            } else {
                source = pictureSource.PHOTOLIBRARY;
            }*/

        }

        function onFail(message) {
            // alert('Failed because: ' + message);
        }

        var qual_id_prog_manut;

        function onPhotoURISuccess(imageURI) {
            document.getElementById('foto_' + qual_id_prog_manut).src = imageURI;
            document.getElementById('foto_' + qual_id_prog_manut).style.display = "inline";

            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 02)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                consultaManutEvento2(db, manutsEvento_imagem);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            var manutsEvento_imagem = [
                {
                    id_prog_manut: qual_id_prog_manut,
                    dia_evento: dia_ev,
                    mes_evento: mes_ev,
                    ano_evento: ano_ev,
                    caminho_imagens: imageURI,
                    caminho_audio: "",
                    caminho_video: "",
                    caminho_texto: "",
                    status_imagens_upl: "0",
                    status_video_upl: "",
                    status_audio_upl: "",
                    status_texto_upl: ""
                }
            ];

            function consultaManutEvento2(db, manutsEvento_imagem) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                var objectStoreRequest = index.openCursor(whereEquals);
                objectStoreRequest.onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        aux_caminho_imagens = data.caminho_imagens;

                        if (aux_caminho_imagens != "") {
                            aux_caminho_imagens = aux_caminho_imagens + '**';

                            aux_status_imagens_upl = data.status_imagens_upl;
                            aux_status_imagens_upl = aux_status_imagens_upl + '**';
                            aux_status_imagens_upl = aux_status_imagens_upl + '0';
                        } else {
                            aux_status_imagens_upl = '0';
                        }

                        data.caminho_imagens = aux_caminho_imagens + imageURI;
                        data.status_imagens_upl = aux_status_imagens_upl;

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            reload_page();
                        }

                    } else {
                        aux_caminho_imagens = "";
                        var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                        var store2 = tx2.objectStore('mtab_prog_manut_evento');

                        manutsEvento_imagem.map(function (manutEvento_imagem) {
                            store2.add(manutEvento_imagem);
                        });

                        tx2.oncomplete = function () {
                            reload_page();
                        }

                        tx2.onerror = function (event) {
                            alert('error storing manut evento note ' + event.target.error);
                        }
                    }
                }
            }
        }

        // DELETAR IMAGEM
        function deletar_imagem(q_id) {
            var q_id;
            var all_images;
            var all_status_images;
            var taman;
            var aux_1 = "";
            var aux_1_status = "";

            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 03)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                deletarManutEvento(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function deletarManutEvento(db) {
                var aux_2;
                var aux_2_status;

                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev])
                var objectStoreRequest = index.openCursor(whereEquals);
                objectStoreRequest.onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        var k;

                        aux_caminho_imagens = data.caminho_imagens;
                        aux_status_imagens_upl = data.status_imagens_upl;

                        all_images = aux_caminho_imagens.split("**")
                        all_status_images = aux_status_imagens_upl.split("**")
                        taman = all_images.length;

                        for (k = 0; k < taman; k++) {
                            if (q_id != k) {
                                aux_1 = aux_1 + all_images[k] + "**"
                                aux_1_status = aux_1_status + all_status_images[k] + "**"
                            }
                        }

                        if (taman > 1) {
                            aux_2 = aux_1.substring(0, aux_1.length - 2);
                            aux_2_status = aux_1_status.substring(0, aux_1_status.length - 2);
                        } else if (taman == 0 || taman == 1) {
                            aux_2 = "";
                            aux_2_status = "";
                        }
                    }

                    deleteUpdateManutEvento(db, aux_2, aux_2_status);
                }
            }

            function deleteUpdateManutEvento(db, aux_2, aux_2_status) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.caminho_imagens = aux_2;
                        data.status_imagens_upl = aux_2_status;

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            reload_page();
                        }
                    }
                }
            }
        }
        // FIM DELETAR IMAGEM

        // UPLOAD IMAGEM
        var aux_1_status = "";

        function upload_imagem(q_id) {

            if (tem_conexao()) {

                var q_id;
                var all_images;
                var all_status_images;
                var taman;
                var aux_1 = "";

                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 04)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    uploadManutEvento(db);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                function uploadManutEvento(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    index.openCursor(whereEquals).onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            var k;
                            aux_caminho_imagens = data.caminho_imagens;

                            all_images = aux_caminho_imagens.split("**");

                            aux_1 = aux_1 + all_images[q_id] + "**";
                            var aux_2 = aux_1.substring(0, aux_1.length - 2);

                            // marcar que foi feito upload para esta imagem

                            aux_status_imagens_upl = data.status_imagens_upl;

                            all_status_images = aux_status_imagens_upl.split("**");
                            taman = all_status_images.length;

                            for (k = 0; k < taman; k++) {
                                if (q_id != k) {
                                    aux_1_status = aux_1_status + all_status_images[k] + "**"
                                }
                                else {
                                    aux_1_status = aux_1_status + "1" + "**"
                                    var ja_fez_upload = all_status_images[k]
                                }
                            }

                            aux_1_status = aux_1_status.substring(0, aux_1_status.length - 2)
                            // fim  marcar que foi feito upload para esta imagem

                            if (ja_fez_upload != '1') {
                                up_loadPhoto(aux_2, q_id, aux_1_status);
                            }
                            else {
                                up_loadPhoto(aux_2, q_id, aux_status_imagens_upl);
                            }
                        }
                    }
                }
            } else {
                navigator.notification.confirm(
                    'Problemas com a sua conexão ao fazer upload da imagem. Tentar novamente?',
                    function (buttonIndex) {
                        if (buttonIndex === 2) {
                            upload_imagem(q_id);
                        }
                    },
                    'SigmaCivil',
                    ['Cancelar', 'Tentar novamente']
                );
            }
        }

        function up_loadPhoto(imageURI, q_k) {

            //if (!uploadAutomatic) {
            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"
            //}

            var q_k;
            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
            options.mimeType = "image/jpeg";

            var params = new Object();
            params.value1 = "test";
            params.value2 = "param";

            options.params = params;
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(imageURI, "http://www.sigmacivil.com.br/app_sc/rec_foto_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.2&econst=" + e_construtora + "&idc=" + id_cliente + "&q_k=" + q_k, win_up, fail_up, options);

        }

        var win_up = function (r) {

            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 05)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                updateManutEventoWinUp(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function updateManutEventoWinUp(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.status_imagens_upl = aux_1_status;

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            //if (!uploadAutomatic) {
                            reload_page();
                            //}
                        }
                    }
                }
            }
        }

        var fail_up = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            // alert("Não foi feito o upload da imagem!");

            navigator.notification.confirm(
                'Não foi feito o upload da imagem. Tentar novamente?',
                function (buttonIndex) {
                    if (buttonIndex === 2) {
                        consultaConfig();
                    }
                },
                'SigmaCivil',
                ['Cancelar', 'Tentar novamente']
            );
        }
        // FIM UPLOAD IMAGEM

        // FIM CAMERA

        // CAPTURAR VIDEO
        function captureVideo(qual) {
            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff2(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            navigator.device.capture.captureVideo(videocaptureSuccess, videocaptureError, { limit: 1, duration: 15 });
        }

        function videocaptureSuccess(mediaFiles) {
            var i, len;
            var m_path;

            for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                m_path = mediaFiles[i].fullPath;

                document.getElementById('video_invis_' + qual_id_prog_manut).style.display = "inline";

                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 06)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    consultaManutEventoVideo(db, manutsEvento_video);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                var manutsEvento_video = [
                    {
                        id_prog_manut: qual_id_prog_manut,
                        dia_evento: dia_ev,
                        mes_evento: mes_ev,
                        ano_evento: ano_ev,
                        caminho_imagens: "",
                        caminho_audio: "",
                        caminho_video: m_path,
                        caminho_texto: "",
                        status_imagens_upl: "",
                        status_video_upl: "0",
                        status_audio_upl: "",
                        status_texto_upl: ""
                    }
                ];

                function consultaManutEventoVideo(db, manutsEvento_video) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    var objectStoreRequest = index.openCursor(whereEquals);
                    objectStoreRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            updateManutEventoVideo(db);
                        } else {
                            var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                            var store2 = tx2.objectStore('mtab_prog_manut_evento');

                            manutsEvento_video.map(function (manutEvento_video) {
                                store2.add(manutEvento_video);
                            });

                            tx2.oncomplete = function () {
                                reload_page();
                            }

                            tx2.onerror = function (event) {
                                alert('error storing manut evento video note ' + event.target.error);
                            }
                        }
                    }
                }

                function updateManutEventoVideo(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    index.openCursor(whereEquals).onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            data.caminho_video = m_path;
                            data.status_video_upl = "0";

                            var request = cursor.update(data);
                            request.onsuccess = function (event) {
                                reload_page();
                            }

                        }
                    }
                }
            }

        }

        // FIM CAPTURAR VIDEO

        function videocaptureError(error) {
            var msg = 'Ocorreu um erro durante a captura do vídeo: ' + error.code;
        }

        // DELETAR VIDEO
        function deletar_video() {

            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 07)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                deleteManutEventoVideo(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function deleteManutEventoVideo(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.caminho_video = "";
                        data.status_video_upl = "0";

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            reload_page();
                        }
                    }
                }
            }
        }
        // FIM DELETAR VIDEO

        function upload_video() {

            if (tem_conexao()) {

                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 08)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    uploadManutEventoVideo(db);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                function uploadManutEventoVideo(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    var objectStoreRequest = index.openCursor(whereEquals);
                    objectStoreRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            if (cursor.value.status_video_upl != '1') {
                                var aux_caminho_video = data.caminho_video;
                                up_loadVideo(aux_caminho_video);
                            }
                            else {
                                var aux_caminho_video = data.caminho_video;
                                up_loadVideo(aux_caminho_video);
                            }
                        }
                    }
                }
            } else {
                navigator.notification.confirm(
                    'Problemas com a sua conexão ao fazer upload do vídeo. Tentar novamente?',
                    function (buttonIndex) {
                        if (buttonIndex === 2) {
                            upload_video();
                        }
                    },
                    'SigmaCivil',
                    ['Cancelar', 'Tentar novamente']
                );
            }
        }

        // UPLOAD VIDEO
        function up_loadVideo(videoURL) {

            //if (!uploadAutomatic) {
            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"
            //}

            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = videoURL.substr(videoURL.lastIndexOf('/') + 1);
            options.mimeType = "video/mp4";
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(videoURL, "http://www.sigmacivil.com.br/app_sc/rec_video_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.2&econst=" + e_construtora + "&idc=" + id_cliente, win_up_v, fail_up_v, options);

        }

        var win_up_v = function (r) {
            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 09)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                updateManutEventoWinUpVideo(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function updateManutEventoWinUpVideo(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.status_video_upl = "1";

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            //if (!uploadAutomatic) {
                            reload_page();
                            //}
                        }
                    }
                }
            }
        }

        var fail_up_v = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            // alert("Não foi feito o upload do vídeo!");

            navigator.notification.confirm(
                'Não foi feito o upload do vídeo. Tentar novamente?',
                function (buttonIndex) {
                    if (buttonIndex === 2) {
                        consultaConfig();
                    }
                },
                'SigmaCivil',
                ['Cancelar', 'Tentar novamente']
            );
        }
        // FIM UPLOAD VIDEO

        // CAPTURAR AUDIO
        var myMedia3 = null;
        var esta_pausado = 0;

        function captureAudio(qual) {
            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff2(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
        }

        function captureSuccess(mediaFiles) {
            var i, len;
            var m_path;

            for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                m_path = mediaFiles[i].fullPath;

                if ((m_path.substring(0, 6) == "file:/") && (m_path.substring(6, 7) != "/")) {
                    m_path = m_path.replace("file:/", "file:///");
                }
                else {
                    m_path = m_path;
                }

                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 10)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    consultaManutEventoAudio(db, manutsEvento_audio);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                var manutsEvento_audio = [
                    {
                        id_prog_manut: qual_id_prog_manut,
                        dia_evento: dia_ev,
                        mes_evento: mes_ev,
                        ano_evento: ano_ev,
                        caminho_imagens: "",
                        caminho_audio: m_path,
                        caminho_video: "",
                        caminho_texto: "",
                        status_imagens_upl: "",
                        status_video_upl: "",
                        status_audio_upl: "0",
                        status_texto_upl: ""
                    }
                ];

                function consultaManutEventoAudio(db, manutsEvento_audio) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    var objectStoreRequest = index.openCursor(whereEquals);
                    objectStoreRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            updateManutEventoAudio(db);

                        } else {
                            var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                            var store2 = tx2.objectStore('mtab_prog_manut_evento');

                            manutsEvento_audio.map(function (manutEvento_audio) {
                                store2.add(manutEvento_audio);
                            });

                            tx2.oncomplete = function () {
                                reload_page();
                            }

                            tx2.onerror = function (event) {
                                alert('error storing manut evento audio note ' + event.target.error);
                            }
                        }
                    }
                }

                function updateManutEventoAudio(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    index.openCursor(whereEquals).onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            data.caminho_audio = m_path;
                            data.status_audio_upl = "0";

                            var request = cursor.update(data);
                            request.onsuccess = function (event) {
                                reload_page();
                            }
                        }
                    }
                }
            }
        }

        function captureError(error) {
            var msg = 'Ocorreu um erro durante a captura do áudio: ' + error.code;
        }

        function abrir_audio(qual) {

            if (esta_pausado == 0) {
                myMedia3 = new Media(qual);
                myMedia3.play();
            }
            if (esta_pausado == 1) {
                myMedia3.play();
                esta_pausado = 0;
            }
        }

        function pause_audio() {
            if (myMedia3) {
                myMedia3.pause();
                esta_pausado = 1;
            }
        }

        function stop_audio() {
            if (myMedia3) {
                myMedia3.stop();
                esta_pausado = 0;
            }
        }
        // FIM CAPTURAR AUDIO

        // DELETAR AUDIO
        function deletar_audio() {
            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 11)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                deleteManutEventoAudio(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function deleteManutEventoAudio(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.caminho_audio = "";
                        data.status_audio_upl = "0";

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            reload_page();
                        }
                    }
                }
            }
        }
        // FIM DELETAR AUDIO

        // UPLOAD AUDIO
        function upload_audio() {

            if (tem_conexao()) {

                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 12)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    uploadManutEventoAudio(db);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                function uploadManutEventoAudio(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    var objectStoreRequest = index.openCursor(whereEquals);
                    objectStoreRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            if (cursor.value.status_audio_upl != '1') {
                                var aux_caminho_audio = data.caminho_audio;
                                up_loadAudio(aux_caminho_audio);
                            }
                            else {
                                var aux_caminho_audio = data.caminho_audio;
                                up_loadAudio(aux_caminho_audio);
                            }
                        }
                    }
                }
            } else {
                navigator.notification.confirm(
                    'Problemas com a sua conexão ao fazer upload do áudio. Tentar novamente?',
                    function (buttonIndex) {
                        if (buttonIndex === 2) {
                            upload_audio();
                        }
                    },
                    'SigmaCivil',
                    ['Cancelar', 'Tentar novamente']
                );
            }
        }

        function up_loadAudio(audioURL) {

            //if (!uploadAutomatic) {
            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"
            //}

            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = audioURL.substr(audioURL.lastIndexOf('/') + 1);
            options.mimeType = "audio/amr";
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(audioURL, "http://www.sigmacivil.com.br/app_sc/rec_audio_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.2&econst=" + e_construtora + "&idc=" + id_cliente, win_up_a, fail_up_a, options);

        }

        var win_up_a = function (r) {
            var db;
            var request = window.indexedDB.open("db_sigmacivil", "1");

            request.onerror = function (event) {
                alert("Erro ao criar o banco (cod 13)");
            };

            request.onsuccess = function (event) {
                db = request.result;

                updateManutEventoWinUpAudio(db);

                db.onerror = function (event) {
                    alert("Database error: " + event.target.errorCode);
                }
            }

            function updateManutEventoWinUpAudio(db) {
                var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                var store = tx.objectStore('mtab_prog_manut_evento');
                var index = store.index('comparar');
                var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                index.openCursor(whereEquals).onsuccess = function (event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        var data = cursor.value;

                        data.status_audio_upl = "1";

                        var request = cursor.update(data);
                        request.onsuccess = function (event) {
                            //if (!uploadAutomatic) {
                            reload_page();
                            //}
                        }
                    }
                }
            }
        }

        var fail_up_a = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            // alert("Não foi feito o upload do áudio!");

            navigator.notification.confirm(
                'Não foi feito o upload do áudio. Tentar novamente?',
                function (buttonIndex) {
                    if (buttonIndex === 2) {
                        consultaConfig();
                    }
                },
                'SigmaCivil',
                ['Cancelar', 'Tentar novamente']
            );
        }
        // FIM UPLOAD AUDIO

        // UPLOAD TEXTO
        function upload_texto() {

            if (tem_conexao()) {
                var db;
                var request = window.indexedDB.open("db_sigmacivil", "1");

                request.onerror = function (event) {
                    alert("Erro ao criar o banco (cod 14)");
                };

                request.onsuccess = function (event) {
                    db = request.result;

                    uploadManutEventoTexto(db);

                    db.onerror = function (event) {
                        alert("Database error: " + event.target.errorCode);
                    }
                }

                function uploadManutEventoTexto(db) {
                    var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store = tx.objectStore('mtab_prog_manut_evento');
                    var index = store.index('comparar');
                    var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                    var objectStoreRequest = index.openCursor(whereEquals);
                    objectStoreRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            var data = cursor.value;

                            if (cursor.value.status_texto_upl != '1') {
                                var aux_caminho_texto = data.caminho_texto;
                                up_loadTexto(aux_caminho_texto);
                            } else {
                                var aux_caminho_texto = data.caminho_texto;
                                up_loadTexto(aux_caminho_texto);
                            }
                        }
                    }
                }
            } else {
                navigator.notification.confirm(
                    'Problemas com a sua conexão ao fazer upload do texto. Tentar novamente?',
                    function (buttonIndex) {
                        if (buttonIndex === 2) {
                            upload_texto();
                        }
                    },
                    'SigmaCivil',
                    ['Cancelar', 'Tentar novamente']
                );
            }
        }

        function up_loadTexto(textoURL) {

            //if (!uploadAutomatic) {
            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"
            //}

            var data = 'tx=' + encodeURIComponent(textoURL) + '&ipm=' + id_prog_manut + '&d=' + dia_ev + '&m=' + mes_ev + '&a=' + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente;
            var ajax = new XMLHttpRequest();
            if (tem_conexao()) {
                ajax.open("POST", "https://www.sigmacivil.com.br/app_sc/rec_texto_uploaded.asp?versao=2.2", true);
                ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                ajax.addEventListener("loadend", function (evt) {
                    var resposta_total = this.responseText;
                    if (resposta_total == "grav_ok") {
                        var db;
                        var request = window.indexedDB.open("db_sigmacivil", "1");

                        request.onerror = function (event) {
                            alert("Erro ao criar o banco (cod 15)");
                        };

                        request.onsuccess = function (event) {
                            db = request.result;

                            uploadManutEventoWinUpTexto(db);

                            db.onerror = function (event) {
                                alert("Database error: " + event.target.errorCode);
                            }
                        }

                        function uploadManutEventoWinUpTexto(db) {
                            var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                            var store = tx.objectStore('mtab_prog_manut_evento');
                            var index = store.index('comparar');
                            var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
                            index.openCursor(whereEquals).onsuccess = function (event) {
                                var cursor = event.target.result;
                                if (cursor) {
                                    var data = cursor.value;

                                    data.status_texto_upl = "1";

                                    var request = cursor.update(data);
                                    request.onsuccess = function (event) {
                                        //if (!uploadAutomatic) {
                                        reload_page();
                                        //}
                                    }
                                }
                            }
                        }
                    } else {
                        document.getElementById("parte_load_content").style.display = "none";
                        document.getElementById("parte_load").style.display = "none";
                        // alert("Problemas com a gravação do texto. Tente novamente mais tarde (cod 08).");

                        navigator.notification.confirm(
                            'Problemas com a gravação do texto. Tentar novamente?',
                            function (buttonIndex) {
                                if (buttonIndex === 2) {
                                    consultaConfig();
                                }
                            },
                            'SigmaCivil',
                            ['Cancelar', 'Tentar novamente']
                        );
                    }
                });

                data = data.split(":").join("%3A")
                data = data.split("{").join(" % 7B")
                data = data.split("}").join("%7D")
                data = data.split(",").join("%2C")
                data = data.split("[").join("%5B")
                data = data.split("]").join("%5D")
                data = data.split(String.fromCharCode(34)).join("%22")

                ajax.send(data);
            } else {
                navigator.notification.confirm(
                    'Problemas com a sua conexão. Tentar novamente?',
                    function (buttonIndex) {
                        if (buttonIndex === 2) {
                            consultaConfig();
                        }
                    },
                    'SigmaCivil',
                    ['Cancelar', 'Tentar novamente']
                );
            }

        }
        // FIM UPLOAD TEXTO

    </script>

</head>

<body>
    <!-- POPUP DA IMAGEM DA GALERIA DE IMAGENS SERVIDOR -->
    <div style="position: fixed; z-index: 5000;" id="popup_img"></div>

    <div class="loading_page"
        style="width: 100%; height: 100vh; display: flex; position: fixed; justify-content: center; align-items: center; z-index: 14;">
        <img src="images/loading.gif" width="40" alt="loading" />
    </div>

    <div id="parte_load_content"
        style="width: 100%; display: none; height: 100%; position: absolute; background: rgba(0,0,0,.7); z-index: 50;">
    </div>

    <!-- MENU ONLINE/OFFLINE -->
    <span id="menu_opc2"></span>

    <!-- NOME EMPREENDIMENTO -->
    <!-- <span id="nome_emp"></span> -->

    <!-- TELA DE LOADING AO ENVIAR ALGUM ARQUIVO PARA A GALERIA DE IMAGENS SERVIDOR -->
    <div id="parte_load"
        style="z-index: 150; display: none; position: fixed; width: 100%; height: 80%; justify-content: center; align-items: center;"
        align="center">
        <table width="224" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="42" height="49">
                    <div align="center">
                        <img src="images/tail-spin.svg" width="35" height="35">
                        <span class="quad_text">Aguarde o envio</span>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- <span id="vistoria"></!-->

    <!-- MENU BURGER -->
    <div class="btn-bars" style="display: none;">
        <div style="top:4; z-index: 30;" data-role="collapsible" data-collapsed="true" class="ui-btn-left menu"
            data-mini="true">
            <h4 class="btn-bars-bars">
                <!-- <span class="fas fa-bars"></span> -->
                <img class="is-bars" src="images/bars.svg" width="14" alt="Menu" />
                <img class="is-times is-disabled" src="images/times.svg" width="13" alt="Menu" />
            </h4>
            <ul style="border: 1px solid #e0e0e0;" data-role="listview" data-mini="true">
                <li>
                    <a class="ui-btn ui-icon-gear ui-btn-icon-right ui-shadow ui-corner-all" href="#"
                        onClick="go_to_page_config()">Configurações</a>
                </li>
                <li>
                    <a class="ui-btn ui-icon-power ui-btn-icon-right ui-shadow ui-corner-all" href="#"
                        onClick="closeApp()">Fechar app</a>
                </li>
                <li>
                    <a style="z-index: 10" class="click" href="#" onClick="enviar_sync()">Logout</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- NOME EMPREENDIMENTO -->
    <div style="text-align: center;">
        <h4 id="nome_empree_id" style="display: inline; position: relative; bottom: 2px;"></h4>
    </div>

    <!-- FILTRO DE BUSCAS DE MANUTENÇÕES -->
    <ul class="list-content" data-mini="true" data-role="listview" data-filter="true"
        data-filter-placeholder="Buscar..." data-inset="true">

        <!-- DADOS DA MANUTENÇÃO ATÉ O CUSTO ESTIMADO/REAL -->
        <div id="dados_manut"></div>

        <!-- <div id="dados_val"></div> -->

        <!-- BLOCO GALERIA DE IMAGENS DO APARELHO -->
        <li class="shadow_box_gallery" style="border-radius: 0; background: #e7d8fc; display: none;">
            <table>
                <div class="ui-grid ui-responsive">
                    <div class="ui-block-a ui-grid-full">
                        <table data-role="table" id="table-column-toggle" data-mode=""
                            class="ui-responsive table-stroke">
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <label style="text-shadow: none; font-weight: 600;" class="label_center_"
                                            for="textarea-1">Galeria
                                            de imagens do
                                            aparelho</label>
                                        <a style="float: right; position: relative; bottom: 28px; left: 16px;"
                                            href="#transitionExample" data-transition="pop" class="ui-btn-inline"
                                            data-rel="popup">
                                            <img src="images/question-circle.png" width="15"
                                                style="text-shadow: none; position: absolute; right: 0;">
                                        </a>
                                        <!-- BLOCO DE CÓDIGO DA CAMERA -->
                                        <a id="capturar_foto"></a>

                                        <img class="foto_small_" style="display: none;" id="foto_" src="" alt=""
                                            width="50" height="50">

                                        <!-- BLOCO DE CÓDIGO AO CLICAR O BOTÃO "?" -->
                                        <div data-role="popup" id="transitionExample" class="ui-content" data-theme="a">
                                            <div id="dados_ajuda"></div>
                                        </div>

                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR ÁUDIO -->
                            <tbody style="margin-top: 5px">
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <a id="capturar_audio"></a>
                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR VÍDEO -->
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <a id="capturar_video"></a>
                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR TEXTO -->
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid transparent">
                                        <a id="capturar_texto"></a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </table>
        </li>

        <!-- BLOCO DE CÓDIGO DE COMENTÁRIOS DO CONDOMÍNIO E CONSTRUTORA -->
        <div id="dados_obs"></div>

        <!-- BLOCO DE CÓDIGO DA GALERIA DE IMAGENS SERVIDOR E BOTÕES SALVAR E VOLTAR -->
        <li class="shadow_box" style="border-radius: 0; padding-left: 1em; display: none;">
            <table>
                <div style="text-align: center;" class="ui-grid-a">
                    <a href="#overlay" data-transition="slideup"
                        style="background: #4793d0; text-shadow: none; color: #fff; position: relative; top: 0;"
                        class="ui-btn ui-icon-camera ui-btn-icon-left ui-corner-all" data-rel="popup">Galeria de
                        imagens servidor</a>
                    <div data-role="popup" id="overlay" class="ui-content" data-theme="a">
                        <a data-rel="back" class="ui-corner-all ui-shadow">
                            <button type="button"
                                style="background: transparent; border: none; text-shadow: none; box-shadow: none; margin: 0; padding: 0; position: relative; bottom: 5px;">
                                <img style="float: right; position: relative; z-index: 10;" src="images/times.svg"
                                    width="15" alt="Close" />
                            </button>

                        </a>

                        <div class="ui-corner-all custom-corners">
                            <div style="background: #4793d0; border-color: #4793d0;"
                                class="ui-bar ui-bar-a condominio_bar">
                                <h3 style="color: #fff; text-shadow: none;">Galeria de imagens do condomínio</h3>
                            </div>
                            <div class="condominio_content" id="condominio_content">
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Imagens:</strong>
                                    </h4>
                                    <div id="imagens_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Vídeos:</strong>
                                    </h4>
                                    <div id="videos_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Áudios:</strong>
                                    </h4>
                                    <div id="audios_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Textos:</strong>
                                    </h4>
                                    <div id="textos_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                            </div>
                        </div>

                        <!-- GALERIA DE IMAGENS SERVIDOR -->
                        <div class="ui-corner-all custom-corners">
                            <div style="background: #4793d0; border-color: #4793d0;"
                                class="ui-bar ui-bar-a construtora_bar">
                                <h3 style="color: #fff; text-shadow: none;">Galeria de imagens da construtora</h3>
                            </div>
                            <div class="construtora_content" id="construtora_content">
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Imagens:</strong>
                                    </h4>
                                    <div id="imagens_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Vídeos:</strong>
                                    </h4>
                                    <div id="videos_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Áudios:</strong>
                                    </h4>
                                    <div id="audios_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Textos:</strong>
                                    </h4>
                                    <div id="textos_bco_constr"></div>
                                </div>
                            </div>
                        </div>
                        <a data-rel="back" class="ui-corner-all ui-shadow botao_click">
                            <button style="background: #c70202; color: #fff; text-shadow: none;"
                                class="ui-btn ui-corner-all">Fechar</button>
                        </a>
                    </div>
                </div>
            </table>
        </li>

        <!-- BOTÕES SALVAR E VOLTAR -->
        <li class="shadow_box" style="border-radius: 0; display: none; margin-bottom: 60px;">
            <table>
                <fieldset class="ui-grid-a">
                    <div class="ui-block-a ui-responsive">
                        <button type="button" class="ui-btn block btn-radius btn-salvar"
                            onclick="enviar_dados();">Salvar</button>
                    </div>
                    <div class="ui-block-b ui-responsive">
                        <div id="btn-voltar"></div>
                    </div>
                </fieldset>
            </table>
        </li>

    </ul>

    <div id="id_ev_email"></div>

    <!-- Menu bottom -->
    <nav class="main-menu-bottom">
        <div>
            <button class="buttons-navigate" type="button" onclick="reload_page_empree()">
                <img src="images/engenheiro_cogs.png" width="22" alt="Home" />
                <p>manutenções</p>
            </button>
            <button class="buttons-navigate" type="button" onclick="scan()">
                <img src="images/qr_code.png" width="22" alt="Qr_code" />
                <p>qrcode</p>
            </button>
            <button class="buttons-navigate" type="button" onclick="go_relat_check2()">
                <img src="images/graph.png" width="22" alt="Relatório" />
                <p>rel.checkpoint</p>
            </button>
            <button class="buttons-navigate" type="button" onclick="openBrowser()">
                <img src="images/call.png" width="22" alt="Chamado" />
                <p>abrir chamado</p>
            </button>
        </div>
    </nav>
    <!-- Fim Menu bottom -->
</body>

</html>

<script>
    $(document).ready(function () {
        $('.circle-question').mouseover(function () {
            $('.screen-over').fadeIn(400)
        })

        $('.fa-times').click(function () {
            $('.screen-over').hide()
        })

        $('.btn-bars .ui-btn').click(function () {
            $('.menu .fa-bars').toggleClass('fa-times')
        })

        $('.btn-bars-bars').click(function () {
            $('.is-bars').toggleClass('is-disabled')
            $('.is-times').toggleClass('is-disabled')
        })

        $('#parte_load').click(function () {
            $('html, body').animate({
                scrollTop: 1500
            }, 500)
        })

        $('.abrir_popup_foto').click(function () {
            $('.pop_photo_big').css({
                display: 'flex'
            })
        })

        $(".btn-salvar").click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 500);
        });

        $("#parte_load").click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 500);
        });

    })

    function FocusInput(element) {
        return element.click()
    }

</script>

<script>

    function abrir_popup(id1, id2) {
        var id1;
        var id2;

        $("#idpopup_" + id1 + "_" + id2).popup();
        $("#idpopup_" + id1 + "_" + id2).popup('open');
    }

    function abrir_popup_new(id) {
        var id;
        $("#idpopup_new_" + id).popup();
        $("#idpopup_new_" + id).popup('open');
    }

    function abrir_popup_gal(id1) {
        var id1;
        $("#idpopup_img_" + id1).css({ display: "flex" });
        $("#idpopup_img_" + id1).css({ display: "flex" });
        $("#popup_fundo_" + id1).css({ display: "block" });
    }

    function fechar_popup_gal(id1) {
        var id1;
        $("#idpopup_img_" + id1).css({ display: "none" });
        $("#idpopup_img_" + id1).css({ display: "none" });
        $("#popup_fundo_" + id1).css({ display: "none" });
    }

    var qual_id_prog_manut;

    // ATUALIZAR O TEXTO
    function atualizar_texto(qual) {
        // RESTRIÇÕES DE DATAS
        if (datadiff2(Date.now(), d_min) > 0) {
            alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
            return
        } else if (datadiff(Date.now(), d_max) < 0) {
            alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
            return
        }

        // var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
        var quale;

        qual_id_prog_manut = qual;
        quale = document.getElementById('textarea_' + qual).value;

        var db;
        var request = window.indexedDB.open("db_sigmacivil", "1");

        request.onerror = function (event) {
            alert("Erro ao criar o banco (cod 16)");
        };

        request.onsuccess = function (event) {
            db = request.result;

            atualizarManutEvento(db, manutsEvento_texto);

            db.onerror = function (event) {
                alert("Database error: " + event.target.errorCode);
            }
        }

        var manutsEvento_texto = [
            {
                id_prog_manut: qual_id_prog_manut,
                dia_evento: dia_ev,
                mes_evento: mes_ev,
                ano_evento: ano_ev,
                caminho_imagens: "",
                caminho_audio: "",
                caminho_video: "",
                caminho_texto: quale,
                status_imagens_upl: "",
                status_video_upl: "",
                status_audio_upl: "",
                status_texto_upl: "0"
            }
        ];

        function atualizarManutEvento(db, manutsEvento_texto) {
            var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
            var store = tx.objectStore('mtab_prog_manut_evento');
            var index = store.index('comparar');
            var whereEquals = IDBKeyRange.only([qual_id_prog_manut, dia_ev, mes_ev, ano_ev]);
            var objectStoreRequest = index.openCursor(whereEquals);
            objectStoreRequest.onsuccess = function (event) {
                var cursor = event.target.result;
                if (cursor) {
                    var data = cursor.value;

                    updateManutEventoTexto(db);

                } else {
                    var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store2 = tx2.objectStore('mtab_prog_manut_evento');

                    manutsEvento_texto.map(function (manutEvento_texto) {
                        store2.add(manutEvento_texto);
                    });

                    tx2.oncomplete = function () {
                        reload_page();
                    }

                    tx2.onerror = function (event) {
                        alert('error storing manut evento texto note ' + event.target.error);
                    }
                }
            }
        }

        function updateManutEventoTexto(db) {
            var tx3 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
            var store3 = tx3.objectStore('mtab_prog_manut_evento');
            var index = store3.index('comparar');
            var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
            index.openCursor(whereEquals).onsuccess = function (event) {
                var cursor = event.target.result;
                if (cursor) {
                    var data = cursor.value;

                    data.caminho_texto = quale;
                    data.status_texto_upl = "0";

                    var request = cursor.update(data);
                    request.onsuccess = function (event) {
                        reload_page();
                    }
                }
            }
        }
    }
    // FIM ATUALIZAR O TEXTO

    function atualizar_texto_empree(qual) {
        // RESTRIÇÕES DE DATAS
        if (datadiff2(Date.now(), d_min) > 0) {
            reload_page_empree();
            return;
        } else if (datadiff(Date.now(), d_max) < 0) {
            reload_page_empree()
            return;
        }

        var quale;

        qual_id_prog_manut = qual;
        quale = document.getElementById('textarea_' + qual).value;

        var db;
        var request = window.indexedDB.open("db_sigmacivil", "1");

        request.onerror = function (event) {
            alert("Erro ao criar o banco (cod 17)");
        };

        request.onsuccess = function (event) {
            db = request.result;

            atualizarManutEventoEmpree(db, manutsEvento_texto_empree);

            db.onerror = function (event) {
                alert("Database error text empree: " + event.target.errorCode);
            }
        }

        var manutsEvento_texto_empree = [
            {
                id_prog_manut: qual_id_prog_manut,
                dia_evento: dia_ev,
                mes_evento: mes_ev,
                ano_evento: ano_ev,
                caminho_imagens: "",
                caminho_audio: "",
                caminho_video: "",
                caminho_texto: quale,
                status_imagens_upl: "",
                status_video_upl: "",
                status_audio_upl: "",
                status_texto_upl: "0"
            }
        ];

        function atualizarManutEventoEmpree(db, manutsEvento_texto_empree) {
            var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
            var store = tx.objectStore('mtab_prog_manut_evento');
            var index = store.index('comparar');
            var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
            var objectStoreRequest = index.openCursor(whereEquals);
            objectStoreRequest.onsuccess = function (event) {
                var cursor = event.target.result;
                if (cursor) {
                    var data = cursor.value;

                    updateManutEventoTextoEmpree(db);

                } else {
                    var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
                    var store2 = tx2.objectStore('mtab_prog_manut_evento');

                    manutsEvento_texto_empree.map(function (manutEvento_texto_empree) {
                        store2.add(manutEvento_texto_empree);
                    });

                    tx2.oncomplete = function () {
                        reload_page_empree();
                    }

                    tx2.onerror = function (event) {
                        alert('error storing manut evento texto_empree note text empree ' + event.target.error);
                    }

                }
            }
        }

        function updateManutEventoTextoEmpree(db) {
            var tx3 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
            var store3 = tx3.objectStore('mtab_prog_manut_evento');
            var index = store3.index('comparar');
            var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
            index.openCursor(whereEquals).onsuccess = function (event) {
                var cursor = event.target.result;
                if (cursor) {
                    var data = cursor.value;

                    data.caminho_texto = quale;

                    data.status_texto_upl = "0";

                    var request = cursor.update(data);
                    request.onsuccess = function (event) {
                        reload_page_empree();
                    }
                }
            }
        }
    }

    function scan() {
        cordova.plugins.barcodeScanner.scan(
            function (result) {
                if (!result.cancelled) {
                    // In this case we only want to process QR Codes
                    if (result.format == "QR_CODE") {
                        var value = result.text;

                        var ponto_ini = value.indexOf("www.sigmacivil.com.br/us/new_qr_hist_mp.asp?c=");
                        var parte1 = value.substring(ponto_ini + 46);

                        var pedaco = parte1.split("_");
                        // alert(id_empree);
                        // alert(pedaco[0]);

                        if (num_empree == pedaco[0]) {

                            var qid_empree = num_empree;
                            var qid_sistema = pedaco[1];

                            var d = new Date();
                            var qdata_checkpoint = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();

                            var qatualizado_serv = "N";

                            navigator.geolocation.getCurrentPosition(
                                function (position) {
                                    var qlatitude_checkpoint = position.coords.latitude;
                                    var qlongitude_checkpoint = position.coords.longitude;
                                    var qaltura_checkpoint = position.coords.altitude;

                                    var db;
                                    var request = window.indexedDB.open("db_sigmacivil", "1");

                                    request.onerror = function (event) {
                                        alert("Erro ao criar o banco (cod 02)");
                                    };

                                    request.onsuccess = function (event) {
                                        db = request.result;

                                        inserirDadosCheckpoint(db, dadosCheckpoint);

                                        db.onerror = function (event) {
                                            alert("Database error: " + event.target.errorCode);
                                        }
                                    }

                                    var dadosCheckpoint = [
                                        {
                                            id_empree: qid_empree,
                                            id_sistema: qid_sistema,
                                            data_checkpoint: qdata_checkpoint,
                                            latitude_checkpoint: qlatitude_checkpoint,
                                            longitude_checkpoint: qlongitude_checkpoint,
                                            altura_checkpoint: qaltura_checkpoint,
                                            atualizado_serv: qatualizado_serv,
                                        }
                                    ];

                                    function inserirDadosCheckpoint(db, dadosCheckpoint) {
                                        var tx = db.transaction(['mtab_checkpoint'], 'readwrite');
                                        var store = tx.objectStore('mtab_checkpoint');

                                        dadosCheckpoint.map(function (dadoCheckpoint) {
                                            store.add(dadoCheckpoint);
                                        });

                                        tx.oncomplete = function () {
                                            go_to_page(qid_sistema, qid_empree);
                                        }

                                        tx.onerror = function (event) {
                                            alert('error storing checkpoint note ' + event.target.error);
                                        }
                                    }
                                },
                                function (error) {
                                    var db;
                                    var request = window.indexedDB.open("db_sigmacivil", "1");

                                    request.onerror = function (event) {
                                        alert("Erro ao criar o banco (cod 03)");
                                    };

                                    request.onsuccess = function (event) {
                                        db = request.result;

                                        inserirDadosCheckpointError(db, dadosCheckpointError);

                                        db.onerror = function (event) {
                                            alert("Database error: " + event.target.errorCode);
                                        }
                                    }

                                    var dadosCheckpointError = [
                                        {
                                            id_empree: qid_empree,
                                            id_sistema: qid_sistema,
                                            data_checkpoint: qdata_checkpoint,
                                            latitude_checkpoint: "",
                                            longitude_checkpoint: "",
                                            altura_checkpoint: "",
                                            atualizado_serv: qatualizado_serv,
                                        }
                                    ];

                                    function inserirDadosCheckpointError(db, dadosCheckpointError) {
                                        var tx = db.transaction(['mtab_checkpoint'], 'readwrite');
                                        var store = tx.objectStore('mtab_checkpoint');

                                        dadosCheckpointError.map(function (dadoCheckpointError) {
                                            store.add(dadoCheckpointError);
                                        });

                                        tx.oncomplete = function () {
                                            go_to_page(qid_sistema, qid_empree);
                                        }

                                        tx.onerror = function (event) {
                                            alert('error storing checkpointError note ' + event.target.error);
                                        }
                                    }
                                }
                            );

                        } else {
                            alert("Esse QRCode não é válido");
                        }

                    } else {
                        alert("Desculpe, só é possível ler QRCODES");
                    }
                } else {
                    // alert("Leitura do QRCODE cancelada");
                }
            },
            function (error) {
                // alert("Erro: " + error);
            }
        );
    }

    function go_to_page(q_id_sistema, q_num_empree) {
        window.location.assign("qrcode.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&e=" + q_num_empree + "&id_sis=" + q_id_sistema + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev));
    }

    function go_to_page_config() {
        window.location.assign("configuracoes.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev));
    }

    function reload_page() {
        window.location.assign("even_online.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev + '&d_min=' + d_min + '&d_max=' + d_max + "&tipo=" + tipo + "&input_data_realiz=" + document.getElementById('in_data_realizacao').value + "&input_forn=" + document.getElementById('valores').value + "&input_custoReal=" + document.getElementById('in_dado_custo_real').value + "&input_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value))
    }

    function reload_page_empree() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            window.location.assign("empree.htm?e=" + id_empree + "&l=" + login + "&s=" + senha + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev))
        }
        else {
            window.location.assign("empree_online.htm?l=" + login + "&s=" + senha + "&e=" + id_empree + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev) + "&n=" + nome_sistema + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev);
        }
    }

    function reload_page_even() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            window.location.assign("even.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
        }
        else {
            window.location.assign("even_online.htm?e=" + num_empree + "&l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev + '&d_min=' + d_min + '&d_max=' + d_max + "&tipo=" + tipo)
        }
    }

    function tem_conexao() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            return false;
        }
        else {
            return true;
        }
    }

    function enviar_sync() {

        decisao = confirm("Confirmar efetuação de um novo login? Será necessário se logar novamente em qualquer empreendimento atualizando o plano de manutenção!");

        if (decisao) {
            document.form_sup.action = "del.htm";
            document.form_sup.submit();
        }

    }

    //////////////////////
    function mascara(o, f) {
        v_obj = o
        v_fun = f
        setTimeout("execmascara()", 1)
    }

    function mascaraTeste(v) {
        v = v.replace(/\D/g, "");
        v = new String(Number(v));
        var len = v.length;
        if (1 == len)
            v = v.replace(/(\d)/, "0,$1");
        else if (2 == len)
            v = v.replace(/(\d)/, "0,$1");
        else if (len > 2) {
            v = v.replace(/(\d{2})$/, ',$1');
            if (len > 5) {
                var x = len - 5
                    , er = new RegExp('(\\d{' + x + '})(\\d)');
                v = v.replace(er, '$1$2');
            }
        }
        return v;
    }

    function execmascara() {
        v_obj.value = v_fun(v_obj.value)
    }

    function sonumeros_data(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que não é dígito
        v = v.replace(/(\d{2})(\d)/, "$1/$2")    //Coloca / entre o segundo e o quarto dígitos
        v = v.replace(/(\d{2})(\d)/, "$1/$2")    //Coloca / entre o quarto e o sexto dígitos
        return v
    }

    function sonumeros_decimais(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que não é dígito
        v = v.replace(/(\d{1})(\d{1,2})$/, "$1,$2")    //coloca virgula antes dos últimos 2 digitos
        return v
    }

    function sonumeros(v) {
        v = v.replace(/\D/g, "")       //Remove tudo o que não é dígito
        return v
    }

    function sonumeros_tel(v) {
        v = v.replace(/\D/g, "")       //Remove tudo o que não é dígito
        v = v.replace(/(\d{0})(\d)/, "$1($2")
        v = v.replace(/(\d{2})(\d)/, "$1)$2")
        return v
    }
    //////////////////////

    function dateToEN(date) {
        return date.split('-').reverse().join('/');
    }

    function dateToEN2(date) {
        return date.split('/').reverse().join('-');
    }

    function transf_data_num(d2) {
        if (d2) {
            var data_form = d2.replace(/[-]/g, '/') + " 00:00:00"
            var data_form2 = new Date(data_form).getTime();
            return data_form2;
        }
    }

    function datadiff(d1, d2) {
        if (d1 && d2) {
            var data_form = d2.replace(/[-]/g, '/') + " 00:00:00"
            var data_form2 = new Date(data_form).getTime();

            return parseInt((data_form2 - d1) / (24 * 3600 * 1000));
        }
    }

    function datadiff2(d1, d2) {
        if (d1 && d2) {
            var data_form = d2.replace(/[-]/g, '/') + " 23:59:59"
            var data_form2 = new Date(data_form).getTime();

            return parseInt((data_form2 - d1) / (24 * 3600 * 1000));
        }
    }

    function enviar_dados() {
        if (tem_conexao()) {
            var crypt_segur = (parseInt(id_empree) * 3) + 5 + (parseInt(id_cliente)) * 2 + 7

            if (e_construtora == 0) {

                var data = document.querySelector('.data_formato')
                var texto = ""
                var continuar = null

                var d = new Date();

                var aux_mes_novo = d.getMonth() + 1;
                aux_mes_novo = '0' + aux_mes_novo
                aux_mes_novo = aux_mes_novo.substring(aux_mes_novo.length - 2, aux_mes_novo.length);

                var aux_dia_novo = d.getDate();
                aux_dia_novo = '0' + aux_dia_novo
                aux_dia_novo = aux_dia_novo.substring(aux_dia_novo.length - 2, aux_dia_novo.length);

                var data_hoje_formatada = d.getFullYear() + '-' + aux_mes_novo + '-' + aux_dia_novo

                var $email_condominio = document.getElementById('email_condominio')
                if ($email_condominio.checked == true) {
                    ev_email = 1
                } else {
                    ev_email = 0
                }

                if (data.value == 0) {
                    alert('Obrigatório o preenchimento da data da realização da manutenção!')
                    FocusInput(data)
                } else if (datadiff2(Date.now(), d_min) > 0) {
                    alert("Essa manutenção só pode ser informada a partir do dia " + dateToEN(d_min) + "!")
                } else if (datadiff(Date.now(), d_max) < 0) {
                    alert("Essa manutenção não pode ser informada após o dia " + dateToEN(d_max) + "!")
                } else if (datadiff2(transf_data_num(dateToEN2(document.getElementById('in_data_realizacao').value)), d_min) > 0) {
                    alert("Essa manutenção só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                } else if (datadiff(transf_data_num(dateToEN2(document.getElementById('in_data_realizacao').value)), d_max) < 0) {
                    alert("Essa manutenção não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                } else if (datadiff(transf_data_num(dateToEN2(document.getElementById('in_data_realizacao').value)), data_hoje_formatada) < 0) {
                    alert("Essa manutenção não pode ser realizada após o dia de hoje!")
                } else if (nivel_manut == 2 && qt_docs == 0) {
                    alert('Esta manutenção precisa de pelo menos 1 documento comprovatório anexado!')
                } else {
                    if (nivel_manut == 1 && qt_docs == 0) {
                        var prosseguir = confirm('É importante anexar um documento que comprove esta manutenção. Tem certeza que deseja prosseguir sem anexar um comprovante?')
                        if (prosseguir == false) { return }
                    }
                    if (qtdDocs_Device > 0) {
                        if (qtdDocs_Device > 1) {
                            continuar = confirm(`Você ainda tem ${qtdDocs_Device} documentos neste aparelho que não estão anexados no servidor! Deseja prosseguir?`)
                        } else {
                            continuar = confirm(`Você ainda tem ${qtdDocs_Device} documento neste aparelho que não está anexado no servidor! Deseja prosseguir?`)
                        }
                        if (continuar == false) { return }
                    }
                    if (prosseguir == true || ((nivel_manut == 1 || nivel_manut == 2) && qt_docs > 0)) {
                        var ajax3 = new XMLHttpRequest();
                        ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/salvar_manut.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&econst=" + e_construtora + "&idpm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&d_data_realiz=" + dateToEN2(document.getElementById('in_data_realizacao').value) + "&d_forn=" + document.getElementById('valores').value + "&d_custoReal=" + document.getElementById('in_dado_custo_real').value + "&d_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value) + "&tipo=" + tipo + "&versao=2.2&env_em=" + ev_email + "&segur=" + crypt_segur + "&t=" + Math.random(), false);
                        ajax3.addEventListener("loadend", function (evt) {
                            var resposta_total = this.responseText;
                            if (tipo == "alt") {
                                alert("Alteração realizada com sucesso!")
                            } else {
                                alert("Manutenção realizada com sucesso!")
                            }

                            atualizar_texto_empree(id_prog_manut);
                        });

                        ajax3.send();
                    }
                }

            } else if (e_construtora == 1) {
                var $email_construtora = document.getElementById('email_construtora')
                if ($email_construtora.checked == true) {
                    ev_email = 1
                } else {
                    ev_email = 0
                }

                if (datadiff2(Date.now(), d_min) > 0) {
                    alert("Essa manutenção só pode ser informada a partir do dia " + dateToEN(d_min) + '!')
                } else if (datadiff(Date.now(), d_max) <= 0) {
                    alert("Essa manutenção não pode ser informada após o dia " + dateToEN(d_max) + '!')
                } else {
                    if (qtdDocs_Device > 0) {
                        if (qtdDocs_Device > 1) {
                            continuar = confirm(`Você ainda tem ${qtdDocs_Device} documentos neste aparelho que não estão anexados no servidor! Deseja prosseguir?`)
                        } else {
                            continuar = confirm(`Você ainda tem ${qtdDocs_Device} documento neste aparelho que não está anexado no servidor! Deseja prosseguir?`)
                        }
                        if (continuar == false) { return }
                    }
                    var ajax3 = new XMLHttpRequest();
                    ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/salvar_manut.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&econst=" + e_construtora + "&idpm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&d_data_realiz=" + document.getElementById('in_data_realizacao').value + "&d_forn=" + document.getElementById('valores').value + "&d_custoReal=" + document.getElementById('in_dado_custo_real').value + "&d_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value) + "&tipo=" + tipo + "&versao=2.2&env_em=" + ev_email + "&segur=" + crypt_segur + "&t=" + Math.random(), false);
                    ajax3.addEventListener("loadend", function (evt) {
                        var resposta_total = this.responseText;
                        alert("Alterações realizadas com sucesso!")

                        atualizar_texto_empree(id_prog_manut);
                    });

                    ajax3.send();

                }
            }
        } else {
            navigator.notification.confirm(
                'Problemas com a sua conexão ao salvar a manutenção. Tentar novamente?',
                function (buttonIndex) {
                    if (buttonIndex === 2) {
                        enviar_dados();
                    }
                },
                'SigmaCivil',
                ['Cancelar', 'Tentar novamente']
            );
        }
    }

    function apagar_fot_vid_aud_tex(q_cam) {
        if (tem_conexao()) {
            var q_cam;
            if (e_construtora == 0) {
                var trash = document.querySelector('.all_trash');

                var res = confirm('Tem certeza que deseja excluir este arquivo?');
                if (res == true) {
                    if (datadiff2(Date.now(), d_min) > 0 || datadiff(Date.now(), d_max) < 0) {
                        alert("A exclusão deste arquivo só pode ser realizada entre o período " + dateToEN(d_min) + ' a ' + dateToEN(d_max) + '!')
                    } else if (nivel_manut == 2 && qt_docs == 1) {
                        alert('Não é possível a exclusão, pois esta manutenção precisa de pelo menos 1 documento comprovatório anexado!')
                    } else {
                        var deletar_arq = "S";
                        if (nivel_manut == 1 && qt_docs == 1) {
                            prosseguir = confirm('É importante anexar um documento que comprove esta manutenção. Tem certeza que deseja prosseguir sem anexar um comprovante?')
                            if (prosseguir == false) {
                                deletar_arq = "N"
                            }
                        }
                        if (deletar_arq == "S") {

                            var verific1 = 3 * parseInt(id_empree) + 3 * parseInt(id_cliente)
                            var verific2 = Math.abs(6 * parseInt(id_empree) - 3 * parseInt(id_cliente))
                            var verific3 = Math.abs(3 * parseInt(id_empree) + 2 * parseInt(id_cliente))
                            var verif_fim = verific1 + "S" + verific2 + "C" + verific3

                            var ajax3 = new XMLHttpRequest();
                            ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_excluir_arq.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&e_const=" + e_construtora + "&seg=" + verif_fim + "&cam=" + q_cam + "&versao=2.2");
                            ajax3.addEventListener("loadend", function (evt) {
                                var resposta_total = this.responseText;
                                reload_page_even();
                            });

                            ajax3.send();

                        }

                    }
                }
            } else if (e_construtora == 1) {
                var res = confirm('Tem certeza que deseja excluir este arquivo?');
                if (res == true) {
                    if (datadiff2(Date.now(), d_min) > 0 || datadiff(Date.now(), d_max) < 0) {
                        alert("A exclusão deste arquivo só pode ser realizada no período de " + dateToEN(d_min) + ' a ' + dateToEN(d_max) + '!')
                    } else {

                        var verific1 = 3 * parseInt(id_empree) + 3 * parseInt(id_cliente)
                        var verific2 = Math.abs(6 * parseInt(id_empree) - 3 * parseInt(id_cliente))
                        var verific3 = Math.abs(3 * parseInt(id_empree) + 2 * parseInt(id_cliente))
                        var verif_fim = verific1 + "S" + verific2 + "C" + verific3

                        var ajax3 = new XMLHttpRequest();
                        ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_excluir_arq.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&e_const=" + e_construtora + "&seg=" + verif_fim + "&cam=" + q_cam + "&versao=2.2");
                        ajax3.addEventListener("loadend", function (evt) {
                            var resposta_total = this.responseText;
                            reload_page_even();
                        });

                        ajax3.send();

                    }
                }
            }
        } else {
            navigator.notification.confirm(
                'Problemas com a sua conexão ao deletar arquivo. Tentar novamente?',
                function (buttonIndex) {
                    if (buttonIndex === 2) {
                        apagar_fot_vid_aud_tex(q_cam);
                    }
                },
                'SigmaCivil',
                ['Cancelar', 'Tentar novamente']
            );
        }
    }

    function ChangeColor(input) {
        input.style.borderColor = "green";
    }

    function BackColor(input) {
        input.style.borderColor = "#dddddd";
    }

    function ChangeColorBlue(input) {
        input.style.borderColor = "#4793d0";
    }

    function BackColorBlue(input) {
        input.style.borderColor = "#dddddd";
    }

    function removeAcento(text) {
        // text = text.toLowerCase();

        // a
        text = text.replace(/Á/g, '@*L1@A')
        text = text.replace(/À/g, '@*L2@A')
        text = text.replace(/Ã/g, '@*L3@A')
        text = text.replace(/Â/g, '@*L4@A')

        text = text.replace(/á/g, '@*L1@a')
        text = text.replace(/à/g, '@*L2@a')
        text = text.replace(/ã/g, '@*L3@a')
        text = text.replace(/â/g, '@*L4@a')

        // e
        text = text.replace(/É/g, '@*L1@E')
        text = text.replace(/È/g, '@*L2@E')
        text = text.replace(/Ê/g, '@*L4@E')

        text = text.replace(/é/g, '@*L1@e')
        text = text.replace(/è/g, '@*L2@e')
        text = text.replace(/ê/g, '@*L4@e')

        // i
        text = text.replace(/Í/g, '@*L1@I')
        text = text.replace(/Ì/g, '@*L2@I')
        text = text.replace(/Î/g, '@*L4@I')

        text = text.replace(/í/g, '@*L1@i')
        text = text.replace(/ì/g, '@*L2@i')
        text = text.replace(/î/g, '@*L4@i')

        // o
        text = text.replace(/Ó/g, '@*L1@O')
        text = text.replace(/Ò/g, '@*L2@O')
        text = text.replace(/Õ/g, '@*L3@O')
        text = text.replace(/Ô/g, '@*L4@O')

        text = text.replace(/ó/g, '@*L1@o')
        text = text.replace(/ò/g, '@*L2@o')
        text = text.replace(/õ/g, '@*L3@o')
        text = text.replace(/ô/g, '@*L4@o')

        // u
        text = text.replace(/Ú/g, '@*L1@U')
        text = text.replace(/Ù/g, '@*L2@U')
        text = text.replace(/Û/g, '@*L4@U')

        text = text.replace(/ú/g, '@*L1@u')
        text = text.replace(/ù/g, '@*L2@u')
        text = text.replace(/û/g, '@*L4@u')

        // ç
        text = text.replace(/Ç/g, '@*L0@C')

        text = text.replace(/ç/g, '@*L0@c')

        return text;
    }

    function go_relat_check2() {
        if (tem_conexao()) {
            window.location.assign("new_checkpoint_hist.htm?e=" + num_empree + /*"&id_sist=" + id_sis +*/ "&l=" + login + "&s=" + senha + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev))
        } else {
            alert('Você está sem conexão com a internet. Para visualizar o relatório online é necessário estar conectado. Favor se conectar.');
        }
    }

    function openBrowser() {
        var options = "location=yes,lefttoright=yes,toolbarcolor=#b10b0b,hideurlbar=yes,closebuttoncaption=<  SigmaCivil,closebuttoncolor=#ffffff";

        cordova.InAppBrowser.open('https://www.google.com.br', '_blank', options);
    }

    function scrollDate() {
        if (getMobileOperatingSystem() == "iOS") {
            document.querySelector('.date_ios').click();
            //document.querySelector('.date_ios').onclick = function() {
            //alert('ponto 8')
            // var options = {
            //     date: new Date(),
            //     mode: 'date'
            // };

            // function onSuccess(date) {
            //     var mes_atual = date.getMonth() + 1;
            //     document.querySelector('.date_ios').value = date.getDate() + '/' + mes_atual + '/' + date.getFullYear();
            // }

            // function onError(error) { // Android only
            //     // alert('Error: ' + error);
            // }

            // datePicker.show(options, onSuccess, onError);
            new Rolldate({
                el: '.date_ios',
                format: 'DD/MM/YYYY',
                beginYear: 2016,
                endYear: 2040
            })
            //};
        }
    }

    function RestricaoData() {
        // RESTRIÇÕES DE DATAS
        var textarea = document.querySelector('.textarea_obs');
        if (datadiff2(Date.now(), d_min) > 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
            return
        } else if (datadiff(Date.now(), d_max) < 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
            return
        }
    }

    function RestricaoData_obs() {
        // RESTRIÇÕES DE DATAS
        var textarea = document.querySelector('.condominio_obs');
        if (datadiff2(Date.now(), d_min) > 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
            return
        } else if (datadiff(Date.now(), d_max) < 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
            return
        }
    }

    function RestricaoData_obs_constr() {
        // RESTRIÇÕES DE DATAS
        var textarea = document.querySelector('.construtora_obs');
        if (datadiff2(Date.now(), d_min) > 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
            return
        } else if (datadiff(Date.now(), d_max) < 0) {
            textarea.setAttribute("readonly", "readonly");
            alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
            return
        }
    }

    function getMobileOperatingSystem() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;

        // Windows Phone must come first because its UA also contains "Android"
        if (/windows phone/i.test(userAgent)) {
            return "Windows Phone";
        }

        if (/android/i.test(userAgent)) {
            return "Android";
        }

        // iOS detection from: http://stackoverflow.com/a/9039885/177710
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            return "iOS";
        }

        return "unknown";
    }

    function closeApp() {
        navigator.notification.confirm(
            'Tem certeza que deseja sair do app SigmaCivil?',
            function (buttonIndex) {
                if (buttonIndex === 2) {
                    return;
                }

                navigator.app.exitApp();
            },
            'SigmaCivil',
            ['OK', 'Cancelar']
        );
    }

</script>