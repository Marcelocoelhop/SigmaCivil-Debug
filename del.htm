<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
	<meta charset="utf-8" />
	<!-- <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/jquery.mobile-1.0.1.min.css" />
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/mc.js" />
	</script>
</head>

<body>

	<script type="text/javascript">


		document.addEventListener("deviceready", onDeviceReady, false);


		function onDeviceReady() {
			iniciar();
		}


		/////////////////////////////
		function iniciar() {

			alert("ponto A");

			window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
			window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
			window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

			if (!window.indexedDB) {
				alert("Seu navegador não suporta uma versão estável do IndexedDB. Alguns recursos não estarão disponíveis.");
			}

			var db;
			alert("ponto B");
			var DBOpenRequest = window.indexedDB.open("db_sigmacivil", "1");

			DBOpenRequest.onerror = function (event) {
				alert("Erro ao criar o banco");
			};

			DBOpenRequest.onsuccess = function (event) {
				alert("ponto sucesso abetura banco");
				db = DBOpenRequest.result;
				// db = event.target.result;
				alert("ponto C1");

				removerDados(db, 'mtab_cliente');
				removerDados(db, 'mtab_empree');
				removerDados(db, 'mtab_prog_manut_evento');
				removerDados(db, 'mtab_prog_manut');

				alert("Os dados do atual empreendimento já foram apagados. Você já pode importar um novo empreendimento!")
				goto();

				//db.onerror = function (event) {
				//		alert("Database error: " + event.target.error);
				//}
			};

			// alert(db)
			// var tx = db.transaction(["mtab_cliente"], 'readwrite');
			// alert("ponto C12");
			// var store = tx.objectStore("mtab_cliente");
			// alert("ponto C2");

			// var objectStoreRequest = store.clear();
			// alert("ponto C3");

			// objectStoreRequest.onsuccess = function (event) {
			// 	alert("dados apagados");
			// }

			//	request.onupgradeneeded = function (event) {
			//		alert("ponto onupgradeneeded");
			//		db = event.target.result;
			// alert('tabela removida');
			// removerTabela(db, 'mtab_cliente');
			// removerTabela(db, 'mtab_empree');
			// removerTabela(db, 'mtab_prog_manut_evento');
			// removerTabela(db, 'mtab_prog_manut');
			// goto();
			//	};

			// request.onsuccess = function (event) {
			// 	alert("ponto D");
			// 	db = request.result;
			// 	//db = event.target.result;

			// 	removerDados(db, 'mtab_cliente');
			// 	removerDados(db, 'mtab_empree');
			// 	removerDados(db, 'mtab_prog_manut_evento');
			// 	removerDados(db, 'mtab_prog_manut');

			// 	alert("Os dados do atual empreendimento já foram apagados. Você já pode importar um novo empreendimento!")
			// 	goto();
			// }

			function removerDados(db, tabela) {
				var tx = db.transaction([tabela], 'readwrite');
				var store = tx.objectStore(tabela);

				var objectStoreRequest = store.clear();
				objectStoreRequest.onsuccess = function (event) {
					alert("dados apagados");
				}
			}

			//request.onerror = function (event) {
			//	alert("Erro na criação: " + event.target.error);
			//}

			function removerTabela(db, tabela) {
				var request = db.deleteObjectStore(tabela);
				alert("ponto3");
			}

			// var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it

			// db.transaction(function (tx) {
			// 	tx.executeSql('DROP TABLE if exists mtab_cliente', [], function (tx, results) {

			// 		tx.executeSql('DROP TABLE if exists mtab_empree', [], function (tx, results) {

			// 			tx.executeSql('DROP TABLE if exists mtab_prog_manut_evento', [], function (tx, results) {

			// 				tx.executeSql('DROP TABLE if exists mtab_prog_manut', [], function (tx, results) {
			// 					alert("Os dados do atual empreendimento já foram apagados. Você já pode importar um novo empreendimento!")
			// 					goto();
			// 				}, null);

			// 			}, null);
			// 		}, null);

			// 	}, null);

			// });


		}

		function goto() {
			document.form1.action = "index.html";
			document.form1.submit();
		}

	</script>

	<form name="form1" action="" method="get">
	</form>
</body>

</html>