<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
	<link rel="stylesheet" href="css/custom.css" />
	<script src="https://kit.fontawesome.com/c202879e33.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/mc.js" />
	</script>

	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>


</head>

<body>

	<script type="text/javascript">
		window.onerror = function (message, url, lineNumber) {
			alert("Error: " + message + " in " + url + " at line " + lineNumber);
		}

	</script>

	<script type="text/javascript">

		var login = getquerystring("l");
		var senha = getquerystring("s");

		var id_prog_manut = getquerystring("ipm");
		var dia_ev = getquerystring("dia_ev");
		var mes_ev = getquerystring("mes_ev");
		var ano_ev = getquerystring("ano_ev");

		var id_cliente;
		var id_empree = "";
		var nome_sistema = "";
		var nome_atividade = "";
		var data_de_hoje = new Date();
		var e_construtora;
		var nome_empree = "";

		document.addEventListener("deviceready", onDeviceReady, false);

		function onDeviceReady() {

			pictureSource = navigator.camera.PictureSourceType;
			destinationType = navigator.camera.DestinationType;

			iniciar();
		}

		/////////////////////////////

		function tem_conexao() {

			if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
				alert('Sem conexão com internet. Favor se conectar.');
				return false;
			}
			else {
				return true;
			}

		}


		/////////////////////////////
		function iniciar() {
			window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
			window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
			window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

			if (!window.indexedDB) {
				alert("Seu navegador não suporta uma versão estável do IndexedDB. Alguns recursos não estarão disponíveis.");
			}

			var menu_sup_offline = [
				'<form name="form_sup" action="" method="get">',
				'<div data-role="header" data-position="fixed" data-theme="a">',
				'<div class="ui-corner-all custom-corners">',
				'<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
				'<div class="barra1" align="left"><img src="images/wifi_vermelho.png" style="position: absolute; left: 85px; top: 20px;" width="17" /></div>',
				'<div align="center">',
				'<a href="#" onClick="volta_uni()"><button style="background: #e9e9e9; border-color: #e9e9e9;" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-carat-l">Voltar</button></a>', '<table width="30" border="0" cellpadding="0" cellspacing="0" >',
				'<tr>',
				'<td width="30" ><img src="images/logo4.png" width="142"> </td>',
				'</tr>',
				'</table>',
				'</div>',
				'</div>',
				'</div>',
				'</div>',
				'</form>'
			].join('');

			var menu_sup_online = [
				'<form name="form_sup" action="" method="get">',
				'<div data-role="header" data-position="fixed" data-theme="a">',
				'<div class="ui-corner-all custom-corners">',
				'<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
				'<div class="barra1" align="left"><img src="images/wifi_verde.png" style="position: absolute; left: 85px; top: 20px;" width="17" /></div>',
				'<div align="center">',
				'<a href="#" onClick="volta_uni()"><button style="background: #e9e9e9; border-color: #e9e9e9;" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-carat-l">Voltar</button></a>',
				'<table width="30" border="0" cellpadding="0" cellspacing="0" >',
				'<tr>',
				'<td width="30" ><img src="images/logo4.png" width="142"> </td>',
				'</tr>',
				'</table>',
				'</div>',
				'</div>',
				'</div>',
				'</div>',
				'</form>'
			].join('');

			document.getElementById('menu_opc2').innerHTML = menu_sup_offline;

			setInterval(function () {
				if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
					document.getElementById('menu_opc2').innerHTML = menu_sup_offline;
					return false;
				}
				else {
					document.getElementById('menu_opc2').innerHTML = menu_sup_online;
					return true;
				}
			}, 5000);

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 01)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				consultaCliente(db);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			function consultaCliente(db) {
				var tx = db.transaction(['mtab_cliente'], 'readwrite');
				var store = tx.objectStore('mtab_cliente');
				var objectStoreRequest = store.openCursor();
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						id_cliente = data.id_cliente;
						e_construtora = data.e_construtora;
					}

					consultaEmpree(db);
				}
			}

			function consultaEmpree(db) {
				var tx = db.transaction(['mtab_empree'], 'readwrite');
				var store = tx.objectStore('mtab_empree');
				var objectStoreRequest = store.openCursor();
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						nome_empree = data.nome_empree;
						id_empree = data.id_empree;
						document.getElementById('nome_emp').innerHTML = nome_empree;
					}

					consultaProgManut(db);
				}
			}

			function consultaProgManut(db) {
				var tx = db.transaction(['mtab_prog_manut'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut');
				var index = store.index('comparar_prog_manut');
				var whereEquals = IDBKeyRange.only(id_prog_manut);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;

					if (cursor) {
						var data = cursor.value;

						nome_sistema = data.nome_sistema;
						nome_atividade = data.nome_atividade;
					}
					consultaProgManutEvento(db);
				}
			}

			function consultaProgManutEvento(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					var i;
					var meio_empree = "";
					var final_empree = "";
					var tam_ti;
					var aux_image_upload;

					if (cursor) {
						var data = cursor.value;

						var rrr_caminho_imagens = data.caminho_imagens;
						var rrr_caminho_texto = data.caminho_texto;
						var rrr_caminho_audio = data.caminho_audio;
						var rrr_caminho_video = data.caminho_video;
						var rrr_id_prog_manut = data.id_prog_manut;
						var rrr_status_caminho_imagens = data.status_imagens_upl;
						var rrr_status_caminho_video = data.status_video_upl;
						var rrr_status_caminho_audio = data.status_audio_upl;
						var rrr_status_caminho_texto = data.status_texto_upl;

					} else {
						var rrr_caminho_imagens = "";
						var rrr_caminho_texto = "";
						var rrr_caminho_audio = "";
						var rrr_caminho_video = "";
						var rrr_id_prog_manut = id_prog_manut;
						var rrr_status_caminho_imagens = "";
						var rrr_status_caminho_video = "";
						var rrr_status_caminho_audio = "";
						var rrr_status_caminho_texto = "";
					}

					var todas_imagens = ""
					var todas_status_imagens = ""
					if (rrr_caminho_imagens == null || rrr_caminho_imagens == "") {
						tam_ti = 0;
					} else {
						todas_imagens = rrr_caminho_imagens.split("**")
						todas_status_imagens = rrr_status_caminho_imagens.split("**")
						tam_ti = todas_imagens.length;
					}

					var selec_imagens_thumb = ""
					var selec_imagens = ""

					for (k = 0; k < tam_ti; k++) {

						if (todas_status_imagens[k] == '0') {
							aux_image_upload = "upload1.gif";
						}
						else {
							aux_image_upload = "upload2.gif";
						}
						//imagens da seta, preta ou verde

						selec_imagens_thumb = selec_imagens_thumb + "<div style='float:left;'><table cellpadding='0' cellspacing='0'><tr><td colspan='2'><img src='" + todas_imagens[k] + "'  onclick='abrir_popup(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + "," + String.fromCharCode(34) + k + String.fromCharCode(34) + " )'  width='106' height='70' hspace='2' vspace='2'/> </td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'/></div></td></tr></table></div>"
						selec_imagens = selec_imagens + "<div data-role='popup' id='idpopup_" + rrr_id_prog_manut + "_" + k + "'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right'>Close</a> <img class='popphoto' src='" + todas_imagens[k] + "' style='max-height:512px;'> </div>"

						//Popup
					}

					if (rrr_status_caminho_audio == '0') {
						aux_image_upload = "upload1.gif";
					}
					else {
						aux_image_upload = "upload2.gif";
					}
					//se ta preta ou verde do áduio

					var selec_audio;
					if (rrr_caminho_audio == "") {
						if (getMobileOperatingSystem() == "iOS") {
							selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><audio style='margin-bottom: 10px; width: 80%; display: none;' controls><source src='" + rrr_caminho_audio + "'></audio><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()'  style='display:none'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()' style='display:none'/></div></td></tr></table></div>"
						} else {
							selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><tr><td colspan='2'><img id='latesq_" + rrr_id_prog_manut + "' src='images/player_latesq.gif'  width='40' height='30' style='display:none'/><img id='player_" + rrr_id_prog_manut + "' src='images/player_play.gif'  onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  width='40' height='30' style='display:none'/><img id='pause_" + rrr_id_prog_manut + "' src='images/player_pause.gif'  onclick='pause_audio()'  width='40' height='30' style='display:none'/><img id='stop_" + rrr_id_prog_manut + "' src='images/player_stop.gif'  onclick='stop_audio()'  width='40' height='30' style='display:none'/><img id='rec_" + rrr_id_prog_manut + "' src='images/player_rec.gif'  onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'  width='40' height='30' style='display:none'/><img id='latdir_" + rrr_id_prog_manut + "'  src='images/player_latdir.gif'  width='40' height='30' style='display:none'/></td></tr><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()'  style='display:none'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()' style='display:none'/></div></td></tr></table></div>"
						}
					} else {
						if (getMobileOperatingSystem() == "iOS") {
							selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><tr><audio style='margin-bottom: 5px; width: 80%; display: inline;' controls><source src='" + rrr_caminho_audio + "'></audio></tr><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()' style='position: relative; left: 100px; bottom: 25px;' /></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()' style='position: relative; left: 200px; bottom: 25px;' /></div></td></tr></table></div>"
						} else {
							selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><tr><td colspan='2'><img id='latesq_" + rrr_id_prog_manut + "' src='images/player_latesq.gif'  width='40' height='30' /><img id='player_" + rrr_id_prog_manut + "' src='images/player_play.gif'  onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  width='40' height='30'/><img id='pause_" + rrr_id_prog_manut + "' src='images/player_pause.gif'  onclick='pause_audio()'  width='40' height='30' /><img id='stop_" + rrr_id_prog_manut + "' src='images/player_stop.gif'  onclick='stop_audio()'  width='40' height='30'/><img id='rec_" + rrr_id_prog_manut + "' src='images/player_rec.gif'  onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'  width='40' height='30' /><img id='latdir_" + rrr_id_prog_manut + "' src='images/player_latdir.gif'  width='40' height='30' /></td></tr><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()'/></div></td></tr></table></div>"
						}
					}
					//barra do áudio

					if (rrr_status_caminho_video == '0') {
						aux_image_upload = "upload1.gif";
					}
					else {
						aux_image_upload = "upload2.gif";
					}
					//setinha do vídeo

					var selec_video;
					if (rrr_caminho_video == "") {
						selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:none'><table cellpadding='0' cellspacing='0'><tr><td height='12' colspan='2'></td></tr><tr><td colspan='2'><video id='qvideo_" + rrr_id_prog_manut + "' controls width='230' height='230'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video></td></tr><tr><td height='3' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_video()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_video()'/></div></td></tr></table></div>"
					}
					else {
						selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:inline'><table cellpadding='0' cellspacing='0'><tr><td height='12' colspan='2'></td></tr><tr><td colspan='2'><video id='qvideo_" + rrr_id_prog_manut + "' controls width='230' height='230'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video></td></tr><tr><td height='3' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_video()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_video()'/></div></td></tr></table></div>"
					}
					//barrinha do vídeo

					if (rrr_status_caminho_texto == '0') {
						aux_image_upload = "upload1.gif";
					}
					else {
						aux_image_upload = "upload2.gif";
					}
					//seta do texto

					var selec_texto;
					selec_texto = rrr_caminho_texto;

					var bot_up
					if (rrr_caminho_texto == "") {
						bot_up = "<div style='display:none'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_texto()'/></div>"
					}
					else {
						bot_up = "<img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_texto()'/>"
					}

					var item_opc = [
						'<div align="center">',
						'<br>',
						'<table width="90%" height="30" border="1" cellpadding="0" cellspacing="0" bordercolor="">',
						'<tr>',
						'<td height="30" bgcolor="#E5E5E5"  > <div align="center">' + colocarAcento(nome_sistema) + '</div>',
						'<div align="center" ></div></td>',
						'</tr>',
						'</table>',
						'<table width="90%" height="30" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
						'<tr>',
						'<td width="90%" bgcolor="#FFFFFF" >',
						'<div style="color: blue" align="left" class="menu_3">' + nome_atividade + '</div></td>',
						'</tr>',
						'</table>',



						'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
						'<tr>',
						'<td width="50" height="40">',
						'<div align="center"><img src="images/photo.gif" onclick="getPhoto(pictureSource.CAMERA,' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
						'</td>',
						'<td width="10"></td>',
						'<td width="220" style="float:left"> <img id="foto_' + rrr_id_prog_manut + '" src=""  onclick="abrir_popup_new(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"  width="106" height="70" hspace="2" vspace="2"  style="display:none"/>   <div data-role="popup" id="idpopup_new_' + rrr_id_prog_manut + '"> <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a> <img id="foto_big_' + rrr_id_prog_manut + '"  class="popphoto" src="" style="max-height:512px;"> </div> ' + selec_imagens_thumb + selec_imagens + '</td>',
						'</tr>',
						'</table>',


						'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
						'<tr>',
						'<td width="50" height="40">',
						'<div align="center"><img src="images/video.gif" onclick="captureVideo(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
						'</td>',
						'<td width="10"></td>',
						'<td width="220" style="float:left">' + selec_video + '</td>',
						'</tr>',
						'</table>',



						'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
						'<tr>',
						'<td width="50" height="40">',
						'<div align="center"><img src="images/audio.gif" onclick="captureAudio(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
						'</td>',
						'<td width="10"></td>',
						'<td width="220" style="float:left">' + selec_audio + '</td>',
						'</tr>',
						'</table>',




						'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
						'<tr>',
						'<td width="50" height="40">',
						'<div align="center"><img src="images/texto.gif"  width="38" height="28" ></div>',
						'</td>',
						'<td width="10"></td>',
						'<td width="220" style="float:left">',
						'<div class="ui-field-contain"><textarea style="width:97%" rows="4"  id="textarea_' + rrr_id_prog_manut + '" maxlength="700">' + selec_texto + '</textarea></div>',
						'<table width="200" height="35" border="0" cellpadding="0" cellspacing="0" >',
						'<tr>',
						'<td width="200" ><div align="center">',
						'<img src="images/but_save.gif"  width="73" height="27" onclick="atualizar_texto(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" style="cursor:pointer">',
						'</div></td>',
						'<td width="100"><div align="center">' + bot_up + '</div></td>',
						'</tr>',
						'</table>',
						'</td>',
						'</tr>',
						'</table>',

						'<br>',
						'</div>'
					].join('');

					//toda a barra contendo a descrição, imagens, videos, audio e texto								

					document.getElementById('vistoria').innerHTML = item_opc;

					consultaProgManutEvento2(db);

				}
			}

			function consultaProgManutEvento2(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					var i2;
					var tam_ti2;

					if (cursor) {
						var data = cursor.value;

						var rrr2_caminho_imagens = data.caminho_imagens;
						var rrr2_id_prog_manut = data.id_prog_manut;
					} else {
						var rrr2_caminho_imagens = "";
						var rrr2_id_prog_manut = id_prog_manut;
					}

					var todas_imagens2 = "";
					var tam_ti2;
					if (rrr2_caminho_imagens == null || rrr2_caminho_imagens == "") {
						tam_ti2 = 0;
					}
					else {
						todas_imagens2 = rrr2_caminho_imagens.split("**");
						tam_ti2 = todas_imagens2.length;
					}

					for (k = 0; k < tam_ti2; k++) {
						$("#idpopup_" + rrr2_id_prog_manut + "_" + k).popup();
					}

					$("#idpopup_new_" + rrr2_id_prog_manut).popup();
				}
			}
		}

	</script>

	<a name="ancora123"></a>

	<span id="menu_opc2"></span>

	<div align="center">
		<table border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td>
					<div align="center"><span id="nome_emp"></span></div>
				</td>
			</tr>
		</table>
	</div>

	<div style="top:4" data-role="collapsible" data-collapsed="true" class="ui-btn-left" data-mini="true">
		<h4>Menu</h4>
		<ul data-role="listview" data-mini="true">
			<li><a href="#" onClick="enviar_sync()">Novo Login</a></li>
		</ul>
	</div>

	<div id="parte_load" align="center" style="display:none">
		<table width="224" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td width="42" height="49">
					<div align="center"><img src="images/loader_blue.gif" width="35" height="35"></div>
				</td>
				<td width="182"><strong>
						<font color="#990000">AGUARDE O ENVIO...</font>
					</strong></td>
			</tr>
		</table>
	</div>

	<span id="vistoria"></span>
	<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

</body>

</html>

<script>

	function abrir_popup(id1, id2) {
		var id1;
		var id2;

		$("#idpopup_" + id1 + "_" + id2).popup();
		$("#idpopup_" + id1 + "_" + id2).popup('open');
	}

	function abrir_popup_new(id) {
		var id;
		$("#idpopup_new_" + id).popup();
		$("#idpopup_new_" + id).popup('open');
	}

	var qual_id_prog_manut

	//////////////////////  ini para  texto   /////////////////////////////
	function atualizar_texto(qual) {
		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 02)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			consultaManutEvento(db, manutsEvento_texto);

			db.onerror = function (event) {
				alert("Database error A: " + event.target.errorCode);
			}
		}

		var quale;

		qual_id_prog_manut = qual;
		quale = document.getElementById('textarea_' + qual).value;

		var manutsEvento_texto = [
			{
				id_prog_manut: qual_id_prog_manut,
				dia_evento: dia_ev,
				mes_evento: mes_ev,
				ano_evento: ano_ev,
				caminho_imagens: "",
				caminho_audio: "",
				caminho_video: "",
				caminho_texto: quale,
				status_imagens_upl: "",
				status_video_upl: "",
				status_audio_upl: "",
				status_texto_upl: "0"
			}
		];

		function consultaManutEvento(db, manutsEvento_texto) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([qual_id_prog_manut, dia_ev, mes_ev, ano_ev]);
			var objectStoreRequest = index.openCursor(whereEquals);
			objectStoreRequest.onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;
					manutsEvento_texto.push(cursor.value);

					updateManutEvento(db, manutsEvento_texto);

				} else {
					var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
					var store2 = tx2.objectStore('mtab_prog_manut_evento');

					manutsEvento_texto.map(function (manutEvento_texto) {
						store2.add(manutEvento_texto);
					});

					tx2.oncomplete = function () {
						reload_page();
					}

					tx2.onerror = function (event) {
						alert('error storing manut evento note B ' + event.target.error);
					}
				}
			}
		}

		function updateManutEvento(db, manutsEvento_texto) {
			var tx3 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store3 = tx3.objectStore('mtab_prog_manut_evento');
			var index = store3.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.caminho_texto = quale;
					data.status_texto_upl = "0";

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}
	//////////////////////  fim  texto   /////////////////////////////

	///////////////////////////////////ini para a camera //////////////////////
	var aux_caminho_imagens = ""
	var aux_status_imagens_upl = ""

	function getPhoto(source, qual) {

		qual_id_prog_manut = qual;

		var r = confirm("Para tirar uma foto com a CÂMERA selecione OK. Para usar sua galeria de imagens selecione CANCELAR");
		if (r == true) {
			source = pictureSource.CAMERA;
		} else {
			source = pictureSource.PHOTOLIBRARY;
		}

		navigator.camera.getPicture(onPhotoURISuccess, onFail, {
			quality: 50,
			destinationType: destinationType.FILE_URI,
			encodingType: Camera.EncodingType.JPEG,
			popoverOptions: CameraPopoverOptions,
			saveToPhotoAlbum: true,
			sourceType: source
		});

	}

	function onFail(message) {
		alert('Failed because: ' + message);
	}

	// Cordova

	function onPhotoURISuccess(imageURI) {
		document.getElementById('foto_' + qual_id_prog_manut).src = imageURI;
		document.getElementById('foto_' + qual_id_prog_manut).style.display = "inline";

		document.getElementById('foto_big_' + qual_id_prog_manut).src = imageURI;

		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 03)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			consultaManutEvento2(db, manutsEvento_imagem);

			db.onerror = function (event) {
				alert("Database error img: " + event.target.errorCode);
			}
		}

		var manutsEvento_imagem = [
			{
				id_prog_manut: qual_id_prog_manut,
				dia_evento: dia_ev,
				mes_evento: mes_ev,
				ano_evento: ano_ev,
				caminho_imagens: imageURI,
				caminho_audio: "",
				caminho_video: "",
				caminho_texto: "",
				status_imagens_upl: "0",
				status_video_upl: "",
				status_audio_upl: "",
				status_texto_upl: ""
			}
		];

		function consultaManutEvento2(db, manutsEvento_imagem) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			var objectStoreRequest = index.openCursor(whereEquals);
			objectStoreRequest.onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					aux_caminho_imagens = cursor.value.caminho_imagens;

					if (aux_caminho_imagens != "") {
						aux_caminho_imagens = aux_caminho_imagens + '**';

						aux_status_imagens_upl = cursor.value.status_imagens_upl;
						aux_status_imagens_upl = aux_status_imagens_upl + '**';
						aux_status_imagens_upl = aux_status_imagens_upl + '0';
					} else {
						aux_status_imagens_upl = '0';
					}

					data.caminho_imagens = aux_caminho_imagens + imageURI;
					data.status_imagens_upl = aux_status_imagens_upl;

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				} else {
					aux_caminho_imagens = "";
					var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
					var store2 = tx2.objectStore('mtab_prog_manut_evento');

					manutsEvento_imagem.map(function (manutEvento_imagem) {
						store2.add(manutEvento_imagem);
					});

					tx2.oncomplete = function () {
						reload_page();
					}

					tx2.onerror = function (event) {
						alert('error storing manut evento note image ' + event.target.error);
					}
				}
			}
		}
	}

	//// deletar imagem ///////////////
	function deletar_imagem(q_id) {
		var q_id;
		var all_images;
		var all_status_images;
		var taman;
		var aux_1 = "";
		var aux_1_status = "";

		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 04)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			deletarManutEvento(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function deletarManutEvento(db) {
			var aux_2;
			var aux_2_status;

			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev])
			var objectStoreRequest = index.openCursor(whereEquals);
			objectStoreRequest.onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					var k;

					aux_caminho_imagens = cursor.value.caminho_imagens;
					aux_status_imagens_upl = cursor.value.status_imagens_upl;

					all_images = aux_caminho_imagens.split("**")
					all_status_images = aux_status_imagens_upl.split("**")
					taman = all_images.length;

					for (k = 0; k < taman; k++) {
						if (q_id != k) {
							aux_1 = aux_1 + all_images[k] + "**"
							aux_1_status = aux_1_status + all_status_images[k] + "**"
						}
					}

					aux_2 = aux_1.substring(0, aux_1.length - 2);
					aux_2_status = aux_1_status.substring(0, aux_1_status.length - 2);
				}

				deleteUpdateManutEvento(db, aux_2, aux_2_status);
			}
		}

		function deleteUpdateManutEvento(db, aux_2, aux_2_status) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.caminho_imagens = aux_2;
					data.status_imagens_upl = aux_2_status;

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}
	/////////  fim  deletar imagem///////

	/////// upload imagem  //////////////////////

	var aux_1_status = "";

	function upload_imagem(q_id) {

		if (tem_conexao()) {

			var q_id;
			var all_images;
			var all_status_images;
			var taman;
			var aux_1 = "";

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 05)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				uploadManutEvento(db);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			function uploadManutEvento(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				index.openCursor(whereEquals).onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						var k;
						aux_caminho_imagens = cursor.value.caminho_imagens;

						all_images = aux_caminho_imagens.split("**");

						aux_1 = aux_1 + all_images[q_id] + "**";
						var aux_2 = aux_1.substring(0, aux_1.length - 2);

						// marcar que foi feito upload para esta imagem

						aux_status_imagens_upl = cursor.value.status_imagens_upl;

						all_status_images = aux_status_imagens_upl.split("**");
						taman = all_status_images.length;

						for (k = 0; k < taman; k++) {
							if (q_id != k) {
								aux_1_status = aux_1_status + all_status_images[k] + "**"
							}
							else {
								aux_1_status = aux_1_status + "1" + "**"
								var ja_fez_upload = all_status_images[k]
							}
						}

						aux_1_status = aux_1_status.substring(0, aux_1_status.length - 2)
						// fim  marcar que foi feito upload para esta imagem

						if (ja_fez_upload != '1') {
							up_loadPhoto(aux_2, q_id, aux_1_status);
						}
						else {
							up_loadPhoto(aux_2, q_id, aux_status_imagens_upl);
						}
					}
				}
			}
		}
	}

	function up_loadPhoto(imageURI, q_k) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var q_k;
		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
		options.mimeType = "image/jpeg";

		var params = new Object();
		params.value1 = "test";
		params.value2 = "param";

		options.params = params;
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(imageURI, "http://www.sigmacivil.com.br/app_sc/rec_foto_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente + "&q_k=" + q_k, win_up, fail_up, options);

	}

	var win_up = function (r) {

		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 06)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			updateManutEventoWinUp(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function updateManutEventoWinUp(db) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.status_imagens_upl = aux_1_status;

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}

	var fail_up = function (error) {
		alert("Houve uma falha ao carregar a imagem. Erro: " + error.code);
	}
	////////// fim upload imagem /////////

	///////////////////////////////////////fim para a camera //////////////////////


	////////////////////////////////////////// INICIO VIDEO  //////////////
	function captureVideo(qual) {
		qual_id_prog_manut = qual;
		navigator.device.capture.captureVideo(videocaptureSuccess, videocaptureError, { limit: 1, duration: 15 });
	}


	function videocaptureSuccess(mediaFiles) {
		var i, len;
		var m_path;

		for (i = 0, len = mediaFiles.length; i < len; i += 1) {
			m_path = mediaFiles[i].fullPath;

			document.getElementById('video_invis_' + qual_id_prog_manut).style.display = "inline";

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 07)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				consultaManutEventoVideo(db, manutsEvento_video);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			var manutsEvento_video = [
				{
					id_prog_manut: qual_id_prog_manut,
					dia_evento: dia_ev,
					mes_evento: mes_ev,
					ano_evento: ano_ev,
					caminho_imagens: "",
					caminho_audio: "",
					caminho_video: m_path,
					caminho_texto: "",
					status_imagens_upl: "",
					status_video_upl: "0",
					status_audio_upl: "",
					status_texto_upl: ""
				}
			];

			function consultaManutEventoVideo(db, manutsEvento_video) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						updateManutEventoVideo(db);

					} else {
						var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
						var store2 = tx2.objectStore('mtab_prog_manut_evento');

						manutsEvento_video.map(function (manutEvento_video) {
							store2.add(manutEvento_video);
						});

						tx2.oncomplete = function () {
							reload_page();
						}

						tx2.onerror = function (event) {
							alert('error storing manut evento video note ' + event.target.error);
						}
					}
				}
			}

			function updateManutEventoVideo(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				index.openCursor(whereEquals).onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						data.caminho_video = m_path;
						data.status_video_upl = "0";

						var request = cursor.update(data);
						request.onsuccess = function (event) {
							reload_page();
						}
					}
				}
			}
		}
	}

	function videocaptureError(error) {
		var msg = 'An error occurred during capture: ' + error.code;
		alert(msg);
	}


	//// deletar video ///////////////
	function deletar_video() {
		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 08)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			deleteManutEventoVideo(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function deleteManutEventoVideo(db) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.caminho_video = "";
					data.status_video_upl = "0";

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}

	}
	/////////  fim  deletar video///////

	/////// upload video  //////////////////////
	function upload_video() {

		if (tem_conexao()) {

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 09)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				uploadManutEventoVideo(db);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			function uploadManutEventoVideo(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						if (cursor.value.status_video_upl != '1') {
							var aux_caminho_video = cursor.value.caminho_video;
							up_loadVideo(aux_caminho_video);
						}
						else {
							var aux_caminho_video = cursor.value.caminho_video;
							up_loadVideo(aux_caminho_video);
						}
					}
				}
			}
		}
	}


	function up_loadVideo(videoURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = videoURL.substr(videoURL.lastIndexOf('/') + 1);
		options.mimeType = "video/mp4";
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(videoURL, "http://www.sigmacivil.com.br/app_sc/rec_video_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente, win_up_v, fail_up_v, options);

	}


	var win_up_v = function (r) {
		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 10)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			updateManutEventoWinUpVideo(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function updateManutEventoWinUpVideo(db) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.status_video_upl = "1";

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}

	var fail_up_v = function (error) {
		alert("An error has occurred: Code = " + error.code);
		alert("Erro ao upar o vídeo")
	}
	/////// fim upload video  //////////////////////

	////////////////////////////////////////// FIM VIDEO  //////////////

	///////////////////////////////////////// INICIO para Audio ////////////////
	var myMedia3 = null;
	var esta_pausado = 0;

	function captureAudio(qual) {
		qual_id_prog_manut = qual;
		navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
	}

	function captureSuccess(mediaFiles) {
		var i, len;
		var m_path;

		for (i = 0, len = mediaFiles.length; i < len; i += 1) {
			m_path = mediaFiles[i].fullPath;

			if ((m_path.substring(0, 6) == "file:/") && (m_path.substring(6, 7) != "/")) {
				m_path = m_path.replace("file:/", "file:///");
			}
			else {
				m_path = m_path;
			}

			if (getMobileOperatingSystem() == "Android") {
				document.getElementById('player_' + qual_id_prog_manut).onclick = function () {
					abrir_audio(m_path);
				};
				document.getElementById('latesq_' + qual_id_prog_manut).style.display = "inline";
				document.getElementById('player_' + qual_id_prog_manut).style.display = "inline";
				document.getElementById('pause_' + qual_id_prog_manut).style.display = "inline";
				document.getElementById('stop_' + qual_id_prog_manut).style.display = "inline";
				document.getElementById('rec_' + qual_id_prog_manut).style.display = "inline";
				document.getElementById('latdir_' + qual_id_prog_manut).style.display = "inline";
			}

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 11)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				consultaManutEventoAudio(db, manutsEvento_audio);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			var manutsEvento_audio = [
				{
					id_prog_manut: qual_id_prog_manut,
					dia_evento: dia_ev,
					mes_evento: mes_ev,
					ano_evento: ano_ev,
					caminho_imagens: "",
					caminho_audio: m_path,
					caminho_video: "",
					caminho_texto: "",
					status_imagens_upl: "",
					status_video_upl: "",
					status_audio_upl: "0",
					status_texto_upl: ""
				}
			];

			function consultaManutEventoAudio(db, manutsEvento_audio) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([qual_id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						updateManutEventoAudio(db);

					} else {
						var tx2 = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
						var store2 = tx2.objectStore('mtab_prog_manut_evento');

						manutsEvento_audio.map(function (manutEvento_audio) {
							store2.add(manutEvento_audio);
						});

						tx2.oncomplete = function () {
							reload_page();
						}

						tx2.onerror = function (event) {
							alert('error storing manut evento audio note ' + event.target.error);
						}
					}
				}
			}

			function updateManutEventoAudio(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([qual_id_prog_manut, dia_ev, mes_ev, ano_ev]);
				index.openCursor(whereEquals).onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						data.caminho_audio = m_path;
						data.status_audio_upl = "0";

						var request = cursor.update(data);
						request.onsuccess = function (event) {
							reload_page();
						}
					}
				}
			}
		}
	}

	function captureError(error) {
		var msg = 'An error occurred during capture: ' + error.code;
		alert(msg);
	}



	function abrir_audio(qual) {
		if (esta_pausado == 0) {
			myMedia3 = new Media(qual);
			myMedia3.play();
		}
		if (esta_pausado == 1) {
			myMedia3.play();
			esta_pausado = 0;
		}

	}

	function pause_audio() {
		if (myMedia3) {
			myMedia3.pause();
			esta_pausado = 1;
		}
	}

	function stop_audio() {
		if (myMedia3) {
			myMedia3.stop();
			esta_pausado = 0;
		}
	}

	//// deletar audio ///////////////
	function deletar_audio() {
		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 12)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			deleteManutEventoAudio(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function deleteManutEventoAudio(db) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.caminho_audio = "";
					data.status_audio_upl = "0";

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}
	/////////  fim  deletar audio///////

	/////// upload audio  //////////////////////
	function upload_audio() {

		if (tem_conexao()) {

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 13)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				uploadManutEventoAudio(db);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			function uploadManutEventoAudio(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						if (cursor.value.status_audio_upl != '1') {
							var aux_caminho_audio = cursor.value.caminho_audio;
							up_loadAudio(aux_caminho_audio);
						} else {
							var aux_caminho_audio = cursor.value.caminho_audio;
							up_loadAudio(aux_caminho_audio);
						}
					}
				}
			}
		}
	}

	function up_loadAudio(audioURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = audioURL.substr(audioURL.lastIndexOf('/') + 1);
		options.mimeType = "audio/amr";
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(audioURL, "http://www.sigmacivil.com.br/app_sc/rec_audio_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente, win_up_a, fail_up_a, options);

	}

	var win_up_a = function (r) {
		var db;
		var request = window.indexedDB.open("db_sigmacivil", "1");

		request.onerror = function (event) {
			alert("Erro ao criar o banco (cod 14)");
		};

		request.onsuccess = function (event) {
			db = request.result;

			updateManutEventoWinUpAudio(db);

			db.onerror = function (event) {
				alert("Database error: " + event.target.errorCode);
			}
		}

		function updateManutEventoWinUpAudio(db) {
			var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
			var store = tx.objectStore('mtab_prog_manut_evento');
			var index = store.index('comparar');
			var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
			index.openCursor(whereEquals).onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					var data = cursor.value;

					data.status_audio_upl = "1";

					var request = cursor.update(data);
					request.onsuccess = function (event) {
						reload_page();
					}
				}
			}
		}
	}

	var fail_up_a = function (error) {
		alert("An error has occurred: Code = " + error.code);
	}
	/////// fim upload audio  //////////////////////

	/////// upload texto  //////////////////////
	function upload_texto() {

		if (tem_conexao()) {

			var db;
			var request = window.indexedDB.open("db_sigmacivil", "1");

			request.onerror = function (event) {
				alert("Erro ao criar o banco (cod 15)");
			};

			request.onsuccess = function (event) {
				db = request.result;

				uploadManutEventoTexto(db);

				db.onerror = function (event) {
					alert("Database error: " + event.target.errorCode);
				}
			}

			function uploadManutEventoTexto(db) {
				var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
				var store = tx.objectStore('mtab_prog_manut_evento');
				var index = store.index('comparar');
				var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
				var objectStoreRequest = index.openCursor(whereEquals);
				objectStoreRequest.onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						var data = cursor.value;

						if (cursor.value.status_texto_upl != '1') {
							var aux_caminho_texto = cursor.value.caminho_texto;
							up_loadTexto(aux_caminho_texto);
						} else {
							var aux_caminho_texto = cursor.value.caminho_texto;
							up_loadTexto(aux_caminho_texto);
						}
					}
				}
			}
		}
	}


	function up_loadTexto(textoURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var data = 'tx=' + encodeURIComponent(textoURL) + '&ipm=' + id_prog_manut + '&d=' + dia_ev + '&m=' + mes_ev + '&a=' + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente;
		var ajax = new XMLHttpRequest();
		ajax.open("POST", "https://www.sigmacivil.com.br/app_sc/rec_texto_uploaded.asp?versao=2.0", true);
		ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		ajax.onreadystatechange = function () {
			if (ajax.readyState == 4) {//Request complete !!
				if (ajax.status == 200 || ajax.status == 0) { // OK response

					var resposta_total = ajax.responseText;
					if (resposta_total == "grav_ok") {
						var db;
						var request = window.indexedDB.open("db_sigmacivil", "1");

						request.onerror = function (event) {
							alert("Erro ao criar o banco (cod 16)");
						};

						request.onsuccess = function (event) {
							db = request.result;

							uploadManutEventoWinUpTexto(db);

							db.onerror = function (event) {
								alert("Database error: " + event.target.errorCode);
							}
						}

						function uploadManutEventoWinUpTexto(db) {
							var tx = db.transaction(['mtab_prog_manut_evento'], 'readwrite');
							var store = tx.objectStore('mtab_prog_manut_evento');
							var index = store.index('comparar');
							var whereEquals = IDBKeyRange.only([id_prog_manut, dia_ev, mes_ev, ano_ev]);
							index.openCursor(whereEquals).onsuccess = function (event) {
								var cursor = event.target.result;
								if (cursor) {
									var data = cursor.value;

									data.status_texto_upl = "1";

									var request = cursor.update(data);
									request.onsuccess = function (event) {
										reload_page();
									}
								}
							}
						}

					} else {
						alert("Problemas com a gravação do texto. Tentar novamente.");
					}

				} else {
					alert("Problemas com sua conexao internet. Erro: 0148");
				}
			}

		}

		data = data.split(":").join("%3A")
		data = data.split("{").join("%7B")
		data = data.split("}").join("%7D")
		data = data.split(",").join("%2C")
		data = data.split("[").join("%5B")
		data = data.split("]").join("%5D")
		data = data.split(String.fromCharCode(34)).join("%22")

		ajax.send(data);

	}

	/////// fim upload texto  //////////////////////

	///////////////////////////////////////// FIM para Audio

	function reload_page() {
		window.location.assign("even.htm?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
	}

	function volta_uni() {

		if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
			// alert('Está offline');
			window.location.assign("empree.htm?l=" + login + "&s=" + senha + "&e=" + id_empree + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev));
		}
		else {
			// alert('Está onlline');
			window.location.assign("empree_online.htm?l=" + login + "&s=" + senha + "&e=" + id_empree + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev));
		}


	}

	function enviar_sync() {

		decisao = confirm("Confirma efetuar novo LOGIN ? Será possível se logar novamente em qualquer empreendimento atualizando o Plano de Manutenção");

		if (decisao) {
			document.form_sup.action = "del.htm";
			document.form_sup.submit();

		} else {
		}

	}

	function colocarAcento(text) {
		text = text.replace(/AxcL1A/g, 'Á');
		text = text.replace(/AxcL2A/g, 'À');
		text = text.replace(/AxcL3A/g, 'Â');
		text = text.replace(/AxcL4A/g, 'Ã');

		text = text.replace(/ExcL1E/g, 'É');
		text = text.replace(/ExcL2E/g, 'È');
		text = text.replace(/ExcL3E/g, 'Ê');

		text = text.replace(/IxcL1I/g, 'Í');
		text = text.replace(/IxcL2I/g, 'Ì');
		text = text.replace(/IxcL3I/g, 'Î');

		text = text.replace(/OxcL1O/g, 'Ó');
		text = text.replace(/OxcL2O/g, 'Ò');
		text = text.replace(/OxcL3O/g, 'Ô');

		text = text.replace(/UxcL1U/g, 'Ú');
		text = text.replace(/UxcL2U/g, 'Ù');
		text = text.replace(/UxcL3U/g, 'Û');

		return text;
	}

	function getMobileOperatingSystem() {
		var userAgent = navigator.userAgent || navigator.vendor || window.opera;

		// Windows Phone must come first because its UA also contains "Android"
		if (/windows phone/i.test(userAgent)) {
			return "Windows Phone";
		}

		if (/android/i.test(userAgent)) {
			return "Android";
		}

		// iOS detection from: http://stackoverflow.com/a/9039885/177710
		if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
			return "iOS";
		}

		return "unknown";
	}

</script>